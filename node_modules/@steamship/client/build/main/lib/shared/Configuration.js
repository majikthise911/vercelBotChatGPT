"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _typeof = require("@babel/runtime/helpers/typeof");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DEFAULT_CONFIG = exports.CONFIG_FILENAME = void 0;
exports.loadConfiguration = loadConfiguration;
exports.saveConfiguration = saveConfiguration;
var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _utils = require("../utils.js");
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }
function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }
var DEFAULT_CONFIG = {
  apiBase: 'https://api.steamship.com/api/v1/',
  appBase: 'https://steamship.run/',
  webBase: 'https://app.steamship.com/'
};

// const defaultStagingCredentials = {
//   apiBase: "https://api.staging.steamship.com/api/v1",
//   appBase: "https://staging.steamship.com/api/v1"
// }
exports.DEFAULT_CONFIG = DEFAULT_CONFIG;
var CONFIG_FILENAME = '.steamship.json';
exports.CONFIG_FILENAME = CONFIG_FILENAME;
var ConfigManager = /*#__PURE__*/function () {
  function ConfigManager() {
    (0, _classCallCheck2["default"])(this, ConfigManager);
    (0, _defineProperty2["default"])(this, "_readFile", undefined);
    (0, _defineProperty2["default"])(this, "_writeFile", undefined);
    (0, _defineProperty2["default"])(this, "_configSearchPath", []);
    (0, _defineProperty2["default"])(this, "_config", {});
  }
  (0, _createClass2["default"])(ConfigManager, [{
    key: "prepare",
    value: function () {
      var _prepare = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        var fs, os, path;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              _context.prev = 0;
              _context.next = 3;
              return Promise.resolve().then(function () {
                return _interopRequireWildcard(require('fs'));
              });
            case 3:
              fs = _context.sent;
              this._readFile = function (filePath) {
                if (!fs.existsSync(filePath)) {
                  return undefined;
                }
                return fs.readFileSync(filePath, 'utf8');
              };
              this._writeFile = function (filePath, data) {
                fs.writeFileSync(filePath, data);
              };
              _context.next = 11;
              break;
            case 8:
              _context.prev = 8;
              _context.t0 = _context["catch"](0);
              // Running from the browser
              this._readFile = function () {
                return undefined;
              };
            case 11:
              _context.prev = 11;
              if (!(0, _utils.isNode)()) {
                _context.next = 20;
                break;
              }
              _context.next = 15;
              return Promise.resolve().then(function () {
                return _interopRequireWildcard(require('os'));
              });
            case 15:
              os = _context.sent;
              _context.next = 18;
              return Promise.resolve().then(function () {
                return _interopRequireWildcard(require('path'));
              });
            case 18:
              path = _context.sent;
              // Try the home folder last.
              this._configSearchPath.push(path.join(os.homedir(), CONFIG_FILENAME));
            case 20:
              _context.next = 26;
              break;
            case 22:
              _context.prev = 22;
              _context.t1 = _context["catch"](11);
              console.log(_context.t1);
              console.log('Unable to load config from search path');
              // pass
            case 26:
            case "end":
              return _context.stop();
          }
        }, _callee, this, [[0, 8], [11, 22]]);
      }));
      function prepare() {
        return _prepare.apply(this, arguments);
      }
      return prepare;
    }()
  }, {
    key: "_read",
    value: function () {
      var _read2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2(filePath, profile) {
        var str, json;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              if (filePath) {
                _context2.next = 2;
                break;
              }
              return _context2.abrupt("return", undefined);
            case 2:
              if ((0, _utils.isNode)()) {
                _context2.next = 4;
                break;
              }
              return _context2.abrupt("return", undefined);
            case 4:
              if (!(typeof this._readFile == 'undefined')) {
                _context2.next = 6;
                break;
              }
              return _context2.abrupt("return", undefined);
            case 6:
              str = this._readFile(filePath);
              if (str) {
                _context2.next = 9;
                break;
              }
              return _context2.abrupt("return", undefined);
            case 9:
              // Let the parsing error trickle up!
              // We want the user to know their config has a problem.
              json = JSON.parse(str);
              if (!profile) {
                _context2.next = 18;
                break;
              }
              if (json['profiles']) {
                _context2.next = 13;
                break;
              }
              return _context2.abrupt("return", undefined);
            case 13:
              if (json['profiles'][profile]) {
                _context2.next = 15;
                break;
              }
              return _context2.abrupt("return", undefined);
            case 15:
              return _context2.abrupt("return", json['profiles'][profile]);
            case 18:
              return _context2.abrupt("return", json);
            case 19:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this);
      }));
      function _read(_x, _x2) {
        return _read2.apply(this, arguments);
      }
      return _read;
    }()
  }, {
    key: "clear",
    value: function clear() {
      this._config = {
        apiBase: DEFAULT_CONFIG.apiBase,
        appBase: DEFAULT_CONFIG.appBase,
        webBase: DEFAULT_CONFIG.webBase
      };
    }
  }, {
    key: "loadFromFile",
    value: function () {
      var _loadFromFile = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(filename, profile) {
        var config;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              if (filename) {
                _context3.next = 2;
                break;
              }
              return _context3.abrupt("return", false);
            case 2:
              _context3.next = 4;
              return this._read(filename, profile);
            case 4:
              config = _context3.sent;
              if (config) {
                _context3.next = 7;
                break;
              }
              return _context3.abrupt("return", false);
            case 7:
              if (config.apiBase) {
                this._config.apiBase = config.apiBase;
              }
              if (config.appBase) {
                this._config.appBase = config.appBase;
              }
              if (config.webBase) {
                this._config.webBase = config.webBase;
              }
              if (config.apiKey) {
                this._config.apiKey = config.apiKey;
              }
              if (config.workspaceId) {
                this._config.workspaceId = config.workspaceId;
              }
              if (config.workspaceHandle) {
                this._config.workspaceHandle = config.workspaceHandle;
              }
              return _context3.abrupt("return", true);
            case 14:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this);
      }));
      function loadFromFile(_x3, _x4) {
        return _loadFromFile.apply(this, arguments);
      }
      return loadFromFile;
    }()
  }, {
    key: "tryAutofindingFiles",
    value: function () {
      var _tryAutofindingFiles = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(profile) {
        var _iterator, _step, configPath, found;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) switch (_context4.prev = _context4.next) {
            case 0:
              _iterator = _createForOfIteratorHelper(this._configSearchPath);
              _context4.prev = 1;
              _iterator.s();
            case 3:
              if ((_step = _iterator.n()).done) {
                _context4.next = 12;
                break;
              }
              configPath = _step.value;
              _context4.next = 7;
              return this.loadFromFile(configPath, profile);
            case 7:
              found = _context4.sent;
              if (!found) {
                _context4.next = 10;
                break;
              }
              return _context4.abrupt("return", true);
            case 10:
              _context4.next = 3;
              break;
            case 12:
              _context4.next = 17;
              break;
            case 14:
              _context4.prev = 14;
              _context4.t0 = _context4["catch"](1);
              _iterator.e(_context4.t0);
            case 17:
              _context4.prev = 17;
              _iterator.f();
              return _context4.finish(17);
            case 20:
              return _context4.abrupt("return", false);
            case 21:
            case "end":
              return _context4.stop();
          }
        }, _callee4, this, [[1, 14, 17, 20]]);
      }));
      function tryAutofindingFiles(_x5) {
        return _tryAutofindingFiles.apply(this, arguments);
      }
      return tryAutofindingFiles;
    }()
  }, {
    key: "loadEnvVars",
    value: function () {
      var _loadEnvVars = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5() {
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) switch (_context5.prev = _context5.next) {
            case 0:
              if (typeof process != 'undefined' && typeof process.env != 'undefined') {
                try {
                  if (process.env['STEAMSHIP_API_BASE']) {
                    this._config.apiBase = process.env['STEAMSHIP_API_BASE'];
                  }
                  if (process.env['STEAMSHIP_APP_BASE']) {
                    this._config.appBase = process.env['STEAMSHIP_APP_BASE'];
                  }
                  if (process.env['STEAMSHIP_WEB_BASE']) {
                    this._config.webBase = process.env['STEAMSHIP_WEB_BASE'];
                  }
                  if (process.env['STEAMSHIP_API_KEY']) {
                    this._config.apiKey = process.env['STEAMSHIP_API_KEY'];
                  }
                  if (process.env['STEAMSHIP_WORKSPACE_ID']) {
                    this._config.workspaceId = process.env['STEAMSHIP_WORKSPACE_ID'];
                  }
                  if (process.env['STEAMSHIP_WORKSPACE_HANDLE']) {
                    this._config.workspaceHandle = process.env['STEAMSHIP_WORKSPACE_HANDLE'];
                  }
                } catch (_unused2) {
                  // pass
                }
              }
            case 1:
            case "end":
              return _context5.stop();
          }
        }, _callee5, this);
      }));
      function loadEnvVars() {
        return _loadEnvVars.apply(this, arguments);
      }
      return loadEnvVars;
    }()
  }, {
    key: "applyManualOverrides",
    value: function applyManualOverrides(params) {
      if (params !== null && params !== void 0 && params.apiBase) {
        this._config.apiBase = params === null || params === void 0 ? void 0 : params.apiBase;
      }
      if (params !== null && params !== void 0 && params.appBase) {
        this._config.appBase = params === null || params === void 0 ? void 0 : params.appBase;
      }
      if (params !== null && params !== void 0 && params.webBase) {
        this._config.webBase = params === null || params === void 0 ? void 0 : params.webBase;
      }
      if (params !== null && params !== void 0 && params.apiKey) {
        this._config.apiKey = params === null || params === void 0 ? void 0 : params.apiKey;
      }
      if (params !== null && params !== void 0 && params.workspace) {
        this._config.workspaceHandle = params === null || params === void 0 ? void 0 : params.workspace;
      }
    }
  }, {
    key: "load",
    value: function () {
      var _load = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6(params) {
        var found;
        return _regenerator["default"].wrap(function _callee6$(_context6) {
          while (1) switch (_context6.prev = _context6.next) {
            case 0:
              _context6.next = 2;
              return this.prepare();
            case 2:
              this.clear();

              // First set the profile.
              if (typeof process != 'undefined' && typeof process.env != 'undefined') {
                if (process.env['STEAMSHIP_PROFILE']) {
                  this._config.profile = process.env['STEAMSHIP_PROFILE'];
                }
              }
              if (params !== null && params !== void 0 && params.profile) {
                this._config.profile = params === null || params === void 0 ? void 0 : params.profile;
              }

              // Then load from a file if provided
              if (!(params !== null && params !== void 0 && params.configFile)) {
                _context6.next = 13;
                break;
              }
              _context6.next = 8;
              return this.loadFromFile(params === null || params === void 0 ? void 0 : params.configFile, this._config.profile);
            case 8:
              found = _context6.sent;
              if (found) {
                _context6.next = 11;
                break;
              }
              throw "Configuration path provided but no configuration found at '".concat(params === null || params === void 0 ? void 0 : params.configFile, "'");
            case 11:
              _context6.next = 15;
              break;
            case 13:
              _context6.next = 15;
              return this.tryAutofindingFiles(this._config.profile);
            case 15:
              _context6.next = 17;
              return this.loadEnvVars();
            case 17:
              // Apply manual overrides
              this.applyManualOverrides(params);

              // Fix the base
              if (this._config.apiBase) {
                if (this._config.apiBase[this._config.apiBase.length - 1] != '/') {
                  this._config.apiBase = "".concat(this._config.apiBase, "/");
                }
              }
              if (this._config.appBase) {
                if (this._config.appBase[this._config.appBase.length - 1] != '/') {
                  this._config.appBase = "".concat(this._config.appBase, "/");
                }
              }
              if (this._config.webBase) {
                if (this._config.webBase[this._config.webBase.length - 1] != '/') {
                  this._config.webBase = "".concat(this._config.webBase, "/");
                }
              }
              return _context6.abrupt("return", this._config);
            case 22:
            case "end":
              return _context6.stop();
          }
        }, _callee6, this);
      }));
      function load(_x6) {
        return _load.apply(this, arguments);
      }
      return load;
    }()
  }, {
    key: "modifyConfiguration",
    value: function () {
      var _modifyConfiguration = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee7(values, profile, configFile) {
        var os, path, str, newConfig;
        return _regenerator["default"].wrap(function _callee7$(_context7) {
          while (1) switch (_context7.prev = _context7.next) {
            case 0:
              _context7.next = 2;
              return this.prepare();
            case 2:
              if (!(!(0, _utils.isNode)() || typeof this._readFile == 'undefined' || typeof this._writeFile == 'undefined')) {
                _context7.next = 4;
                break;
              }
              throw 'Could not save configuration, no filesystem found.';
            case 4:
              _context7.next = 6;
              return Promise.resolve().then(function () {
                return _interopRequireWildcard(require('os'));
              });
            case 6:
              os = _context7.sent;
              _context7.next = 9;
              return Promise.resolve().then(function () {
                return _interopRequireWildcard(require('path'));
              });
            case 9:
              path = _context7.sent;
              if (!(typeof configFile === 'string' && configFile.trim() === '')) {
                _context7.next = 12;
                break;
              }
              throw 'An invalid save location was given.';
            case 12:
              if (!configFile) {
                configFile = path.join(os.homedir(), CONFIG_FILENAME);
              }
              str = this._readFile(configFile);
              newConfig = _objectSpread({}, DEFAULT_CONFIG);
              if (str) {
                try {
                  newConfig = JSON.parse(str);
                } catch (e) {
                  // If there is an issue with the config, we just use the default
                }
              }

              // Now set the desired values. If there is a profile, only do this to that
              // profile. Otherwise, override the fields.
              if (profile) {
                if (!newConfig.profiles) {
                  newConfig.profiles = {}; // Add the profiles field if it does not exist
                }

                if (!Object.keys(newConfig.profiles).includes(profile)) {
                  newConfig.profiles[profile] = {
                    profile: profile
                  }; // Adds this specific profile
                }

                Object.keys(values).forEach(function (key) {
                  if (key === 'profiles') {
                    throw 'Cannot save a profiles list within a profile itself. A `profiles` modification is only allowed on the default config (i.e. leave `profile` blank)';
                  }
                  // eslint-disable-next-line @typescript-eslint/ban-ts-comment
                  // @ts-ignore
                  newConfig.profiles[profile][key] = values[key];
                });
              } else {
                Object.keys(values).forEach(function (key) {
                  // eslint-disable-next-line @typescript-eslint/ban-ts-comment
                  // @ts-ignore
                  newConfig[key] = values[key];
                });
              }

              // Finally, save the configuration
              this._writeFile(configFile, JSON.stringify(newConfig, undefined, 2));
            case 18:
            case "end":
              return _context7.stop();
          }
        }, _callee7, this);
      }));
      function modifyConfiguration(_x7, _x8, _x9) {
        return _modifyConfiguration.apply(this, arguments);
      }
      return modifyConfiguration;
    }()
  }]);
  return ConfigManager;
}();
function loadConfiguration(_x10) {
  return _loadConfiguration.apply(this, arguments);
}
/**
 * Modifies or creates a configuration given the desired values. Allows
 * modifying the default profile, or modifying individual profiles by
 * providing a `profile` parameter. If no configFile is given, defaults
 * to the default location (home directory / .steamship.json).
 * Note: If the configFile already exists, the existing file is modified.
 *       If the file is corrupt or missing, a new file is created
 * @param values The values to save to the config or profile
 * @param profile (Optional) The profile to override. Defaults to the default
 *                profile.
 * @param configFile (Optional) The absolute location to the file to save
 *                   to. Defaults to (home directory / .steamship.json)
 */
function _loadConfiguration() {
  _loadConfiguration = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee8(params) {
    var configManager;
    return _regenerator["default"].wrap(function _callee8$(_context8) {
      while (1) switch (_context8.prev = _context8.next) {
        case 0:
          configManager = new ConfigManager();
          _context8.next = 3;
          return configManager.load(params);
        case 3:
          return _context8.abrupt("return", _context8.sent);
        case 4:
        case "end":
          return _context8.stop();
      }
    }, _callee8);
  }));
  return _loadConfiguration.apply(this, arguments);
}
function saveConfiguration(_x11, _x12, _x13) {
  return _saveConfiguration.apply(this, arguments);
}
function _saveConfiguration() {
  _saveConfiguration = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee9(values, profile, configFile) {
    var configManager;
    return _regenerator["default"].wrap(function _callee9$(_context9) {
      while (1) switch (_context9.prev = _context9.next) {
        case 0:
          configManager = new ConfigManager();
          _context9.next = 3;
          return configManager.modifyConfiguration(values, profile, configFile);
        case 3:
        case "end":
          return _context9.stop();
      }
    }, _callee9);
  }));
  return _saveConfiguration.apply(this, arguments);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJERUZBVUxUX0NPTkZJRyIsImFwaUJhc2UiLCJhcHBCYXNlIiwid2ViQmFzZSIsIkNPTkZJR19GSUxFTkFNRSIsIkNvbmZpZ01hbmFnZXIiLCJ1bmRlZmluZWQiLCJmcyIsIl9yZWFkRmlsZSIsImZpbGVQYXRoIiwiZXhpc3RzU3luYyIsInJlYWRGaWxlU3luYyIsIl93cml0ZUZpbGUiLCJkYXRhIiwid3JpdGVGaWxlU3luYyIsImlzTm9kZSIsIm9zIiwicGF0aCIsIl9jb25maWdTZWFyY2hQYXRoIiwicHVzaCIsImpvaW4iLCJob21lZGlyIiwiY29uc29sZSIsImxvZyIsInByb2ZpbGUiLCJzdHIiLCJqc29uIiwiSlNPTiIsInBhcnNlIiwiX2NvbmZpZyIsImZpbGVuYW1lIiwiX3JlYWQiLCJjb25maWciLCJhcGlLZXkiLCJ3b3Jrc3BhY2VJZCIsIndvcmtzcGFjZUhhbmRsZSIsImNvbmZpZ1BhdGgiLCJsb2FkRnJvbUZpbGUiLCJmb3VuZCIsInByb2Nlc3MiLCJlbnYiLCJwYXJhbXMiLCJ3b3Jrc3BhY2UiLCJwcmVwYXJlIiwiY2xlYXIiLCJjb25maWdGaWxlIiwidHJ5QXV0b2ZpbmRpbmdGaWxlcyIsImxvYWRFbnZWYXJzIiwiYXBwbHlNYW51YWxPdmVycmlkZXMiLCJsZW5ndGgiLCJ2YWx1ZXMiLCJ0cmltIiwibmV3Q29uZmlnIiwiZSIsInByb2ZpbGVzIiwiT2JqZWN0Iiwia2V5cyIsImluY2x1ZGVzIiwiZm9yRWFjaCIsImtleSIsInN0cmluZ2lmeSIsImxvYWRDb25maWd1cmF0aW9uIiwiY29uZmlnTWFuYWdlciIsImxvYWQiLCJzYXZlQ29uZmlndXJhdGlvbiIsIm1vZGlmeUNvbmZpZ3VyYXRpb24iXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL3NoYXJlZC9Db25maWd1cmF0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlzTm9kZSB9IGZyb20gJy4uL3V0aWxzLmpzJztcblxuLypcbiAqIFRoZSBnb2FsIG9mIHRoaXMgZmlsZSBpcyB0byBwcm92aWRlIGEgY3JlZGVudGlhbC1sb2FkaW5nIHN5c3RlbVxuICogdGhhdCBpcyBzYWZlIGluIEJPVEggdGhlIGNvbW1hbmQgbGluZSBhbmQgdGhlIGJyb3dzZXIuXG4gKi9cblxuZXhwb3J0IGludGVyZmFjZSBDb25maWd1cmF0aW9uIHtcbiAgYXBpS2V5Pzogc3RyaW5nO1xuICBhcGlCYXNlPzogc3RyaW5nO1xuICBhcHBCYXNlPzogc3RyaW5nO1xuICB3ZWJCYXNlPzogc3RyaW5nO1xuICB3b3Jrc3BhY2VJZD86IHN0cmluZztcbiAgd29ya3NwYWNlSGFuZGxlPzogc3RyaW5nO1xuICBwcm9maWxlPzogc3RyaW5nO1xuICBwcm9maWxlcz86IHsgW25hbWU6IHN0cmluZ106IENvbmZpZ3VyYXRpb24gfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMb2FkQ29uZmlnUGFyYW1zIHtcbiAgYXBpS2V5Pzogc3RyaW5nO1xuICBhcGlCYXNlPzogc3RyaW5nOyAvLyBodHRwczovL2FwaS5zdGVhbXNoaXAuY29tL2FwaS92MVxuICBhcHBCYXNlPzogc3RyaW5nOyAvLyBodHRwczovL3N0ZWFtc2hpcC5ydW4vXG4gIHdlYkJhc2U/OiBzdHJpbmc7IC8vIGh0dHBzOi8vYXBwLnN0ZWFtc2hpcC5jb21cbiAgd29ya3NwYWNlPzogc3RyaW5nO1xuICBwcm9maWxlPzogc3RyaW5nO1xuICBjb25maWdGaWxlPzogc3RyaW5nOyAvLyBjb25maWcgZmlsZSBvbiBkaXNrXG4gIGZhaWxJZldvcmtzcGFjZUV4aXN0cz86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2F2ZUNvbmZpZ1BhcmFtcyB7XG4gIGFwaUtleT86IHN0cmluZztcbiAgYXBpQmFzZT86IHN0cmluZztcbiAgYXBwQmFzZT86IHN0cmluZztcbiAgd2ViQmFzZT86IHN0cmluZztcbiAgd29ya3NwYWNlSWQ/OiBzdHJpbmc7XG4gIHdvcmtzcGFjZUhhbmRsZT86IHN0cmluZztcbiAgcHJvZmlsZT86IHN0cmluZztcbiAgcHJvZmlsZXM/OiB7IFtuYW1lOiBzdHJpbmddOiBDb25maWd1cmF0aW9uIH07IC8vIE9ubHkgYWxsb3dlZCBpZiBub3QgbW9kaWZ5aW5nIGEgcHJvZmlsZVxufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9DT05GSUc6IHtcbiAgYXBpQmFzZTogc3RyaW5nO1xuICBhcHBCYXNlOiBzdHJpbmc7XG4gIHdlYkJhc2U6IHN0cmluZztcbn0gPSB7XG4gIGFwaUJhc2U6ICdodHRwczovL2FwaS5zdGVhbXNoaXAuY29tL2FwaS92MS8nLFxuICBhcHBCYXNlOiAnaHR0cHM6Ly9zdGVhbXNoaXAucnVuLycsXG4gIHdlYkJhc2U6ICdodHRwczovL2FwcC5zdGVhbXNoaXAuY29tLycsXG59O1xuXG4vLyBjb25zdCBkZWZhdWx0U3RhZ2luZ0NyZWRlbnRpYWxzID0ge1xuLy8gICBhcGlCYXNlOiBcImh0dHBzOi8vYXBpLnN0YWdpbmcuc3RlYW1zaGlwLmNvbS9hcGkvdjFcIixcbi8vICAgYXBwQmFzZTogXCJodHRwczovL3N0YWdpbmcuc3RlYW1zaGlwLmNvbS9hcGkvdjFcIlxuLy8gfVxuXG5leHBvcnQgY29uc3QgQ09ORklHX0ZJTEVOQU1FID0gJy5zdGVhbXNoaXAuanNvbic7XG5cbmNsYXNzIENvbmZpZ01hbmFnZXIge1xuICBfcmVhZEZpbGU6IHVuZGVmaW5lZCB8ICgoZmlsZVBhdGg6IHN0cmluZykgPT4gc3RyaW5nIHwgdW5kZWZpbmVkKSA9IHVuZGVmaW5lZDtcbiAgX3dyaXRlRmlsZTogdW5kZWZpbmVkIHwgKChmaWxlUGF0aDogc3RyaW5nLCBkYXRhOiBzdHJpbmcpID0+IHZvaWQpID1cbiAgICB1bmRlZmluZWQ7XG4gIF9jb25maWdTZWFyY2hQYXRoOiBzdHJpbmdbXSA9IFtdO1xuICBfY29uZmlnOiBDb25maWd1cmF0aW9uID0ge307XG5cbiAgYXN5bmMgcHJlcGFyZSgpIHtcbiAgICAvLyBDcmVhdGUgdGhlIF9yZWFkRmlsZSBmdW5jdGlvblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBmcyA9IGF3YWl0IGltcG9ydCgnZnMnKTtcbiAgICAgIHRoaXMuX3JlYWRGaWxlID0gKGZpbGVQYXRoOiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQgPT4ge1xuICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZmlsZVBhdGgpKSB7XG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoLCAndXRmOCcpO1xuICAgICAgfTtcbiAgICAgIHRoaXMuX3dyaXRlRmlsZSA9IChmaWxlUGF0aDogc3RyaW5nLCBkYXRhOiBzdHJpbmcpID0+IHtcbiAgICAgICAgZnMud3JpdGVGaWxlU3luYyhmaWxlUGF0aCwgZGF0YSk7XG4gICAgICB9O1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy8gUnVubmluZyBmcm9tIHRoZSBicm93c2VyXG4gICAgICB0aGlzLl9yZWFkRmlsZSA9ICgpOiBzdHJpbmcgfCB1bmRlZmluZWQgPT4ge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgaWYgKGlzTm9kZSgpKSB7XG4gICAgICAgIC8vIEZpcnN0IHNlYXJjaCBmb3IgLnN0ZWFtc2hpcC5qc29uIGluIHRoZSBjdXJyZW50IHRyZWUuXG4gICAgICAgIGNvbnN0IG9zID0gYXdhaXQgaW1wb3J0KCdvcycpO1xuICAgICAgICBjb25zdCBwYXRoID0gYXdhaXQgaW1wb3J0KCdwYXRoJyk7XG4gICAgICAgIC8vIFRyeSB0aGUgaG9tZSBmb2xkZXIgbGFzdC5cbiAgICAgICAgdGhpcy5fY29uZmlnU2VhcmNoUGF0aC5wdXNoKHBhdGguam9pbihvcy5ob21lZGlyKCksIENPTkZJR19GSUxFTkFNRSkpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICBjb25zb2xlLmxvZyhleCk7XG4gICAgICBjb25zb2xlLmxvZygnVW5hYmxlIHRvIGxvYWQgY29uZmlnIGZyb20gc2VhcmNoIHBhdGgnKTtcbiAgICAgIC8vIHBhc3NcbiAgICB9XG4gIH1cblxuICBhc3luYyBfcmVhZChcbiAgICBmaWxlUGF0aD86IHN0cmluZyxcbiAgICBwcm9maWxlPzogc3RyaW5nXG4gICk6IFByb21pc2U8Q29uZmlndXJhdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgIGlmICghZmlsZVBhdGgpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGlmICghaXNOb2RlKCkpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgdGhpcy5fcmVhZEZpbGUgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RyID0gdGhpcy5fcmVhZEZpbGUoZmlsZVBhdGgpO1xuICAgIGlmICghc3RyKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvLyBMZXQgdGhlIHBhcnNpbmcgZXJyb3IgdHJpY2tsZSB1cCFcbiAgICAvLyBXZSB3YW50IHRoZSB1c2VyIHRvIGtub3cgdGhlaXIgY29uZmlnIGhhcyBhIHByb2JsZW0uXG4gICAgY29uc3QganNvbiA9IEpTT04ucGFyc2Uoc3RyKTtcblxuICAgIGlmIChwcm9maWxlKSB7XG4gICAgICBpZiAoIWpzb25bJ3Byb2ZpbGVzJ10pIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIGlmICghanNvblsncHJvZmlsZXMnXVtwcm9maWxlXSkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGpzb25bJ3Byb2ZpbGVzJ11bcHJvZmlsZV0gYXMgQ29uZmlndXJhdGlvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGpzb24gYXMgQ29uZmlndXJhdGlvbjtcbiAgICB9XG4gIH1cblxuICBjbGVhcigpIHtcbiAgICB0aGlzLl9jb25maWcgPSB7XG4gICAgICBhcGlCYXNlOiBERUZBVUxUX0NPTkZJRy5hcGlCYXNlLFxuICAgICAgYXBwQmFzZTogREVGQVVMVF9DT05GSUcuYXBwQmFzZSxcbiAgICAgIHdlYkJhc2U6IERFRkFVTFRfQ09ORklHLndlYkJhc2UsXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGxvYWRGcm9tRmlsZShmaWxlbmFtZT86IHN0cmluZywgcHJvZmlsZT86IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghZmlsZW5hbWUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgY29uZmlnID0gYXdhaXQgdGhpcy5fcmVhZChmaWxlbmFtZSwgcHJvZmlsZSk7XG4gICAgaWYgKCFjb25maWcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZy5hcGlCYXNlKSB7XG4gICAgICB0aGlzLl9jb25maWcuYXBpQmFzZSA9IGNvbmZpZy5hcGlCYXNlO1xuICAgIH1cbiAgICBpZiAoY29uZmlnLmFwcEJhc2UpIHtcbiAgICAgIHRoaXMuX2NvbmZpZy5hcHBCYXNlID0gY29uZmlnLmFwcEJhc2U7XG4gICAgfVxuICAgIGlmIChjb25maWcud2ViQmFzZSkge1xuICAgICAgdGhpcy5fY29uZmlnLndlYkJhc2UgPSBjb25maWcud2ViQmFzZTtcbiAgICB9XG4gICAgaWYgKGNvbmZpZy5hcGlLZXkpIHtcbiAgICAgIHRoaXMuX2NvbmZpZy5hcGlLZXkgPSBjb25maWcuYXBpS2V5O1xuICAgIH1cbiAgICBpZiAoY29uZmlnLndvcmtzcGFjZUlkKSB7XG4gICAgICB0aGlzLl9jb25maWcud29ya3NwYWNlSWQgPSBjb25maWcud29ya3NwYWNlSWQ7XG4gICAgfVxuICAgIGlmIChjb25maWcud29ya3NwYWNlSGFuZGxlKSB7XG4gICAgICB0aGlzLl9jb25maWcud29ya3NwYWNlSGFuZGxlID0gY29uZmlnLndvcmtzcGFjZUhhbmRsZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBhc3luYyB0cnlBdXRvZmluZGluZ0ZpbGVzKHByb2ZpbGU/OiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBmb3IgKGNvbnN0IGNvbmZpZ1BhdGggb2YgdGhpcy5fY29uZmlnU2VhcmNoUGF0aCkge1xuICAgICAgY29uc3QgZm91bmQgPSBhd2FpdCB0aGlzLmxvYWRGcm9tRmlsZShjb25maWdQYXRoLCBwcm9maWxlKTtcbiAgICAgIGlmIChmb3VuZCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgYXN5bmMgbG9hZEVudlZhcnMoKSB7XG4gICAgaWYgKHR5cGVvZiBwcm9jZXNzICE9ICd1bmRlZmluZWQnICYmIHR5cGVvZiBwcm9jZXNzLmVudiAhPSAndW5kZWZpbmVkJykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKHByb2Nlc3MuZW52WydTVEVBTVNISVBfQVBJX0JBU0UnXSkge1xuICAgICAgICAgIHRoaXMuX2NvbmZpZy5hcGlCYXNlID0gcHJvY2Vzcy5lbnZbJ1NURUFNU0hJUF9BUElfQkFTRSddO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcm9jZXNzLmVudlsnU1RFQU1TSElQX0FQUF9CQVNFJ10pIHtcbiAgICAgICAgICB0aGlzLl9jb25maWcuYXBwQmFzZSA9IHByb2Nlc3MuZW52WydTVEVBTVNISVBfQVBQX0JBU0UnXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHJvY2Vzcy5lbnZbJ1NURUFNU0hJUF9XRUJfQkFTRSddKSB7XG4gICAgICAgICAgdGhpcy5fY29uZmlnLndlYkJhc2UgPSBwcm9jZXNzLmVudlsnU1RFQU1TSElQX1dFQl9CQVNFJ107XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHByb2Nlc3MuZW52WydTVEVBTVNISVBfQVBJX0tFWSddKSB7XG4gICAgICAgICAgdGhpcy5fY29uZmlnLmFwaUtleSA9IHByb2Nlc3MuZW52WydTVEVBTVNISVBfQVBJX0tFWSddO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcm9jZXNzLmVudlsnU1RFQU1TSElQX1dPUktTUEFDRV9JRCddKSB7XG4gICAgICAgICAgdGhpcy5fY29uZmlnLndvcmtzcGFjZUlkID0gcHJvY2Vzcy5lbnZbJ1NURUFNU0hJUF9XT1JLU1BBQ0VfSUQnXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHJvY2Vzcy5lbnZbJ1NURUFNU0hJUF9XT1JLU1BBQ0VfSEFORExFJ10pIHtcbiAgICAgICAgICB0aGlzLl9jb25maWcud29ya3NwYWNlSGFuZGxlID1cbiAgICAgICAgICAgIHByb2Nlc3MuZW52WydTVEVBTVNISVBfV09SS1NQQUNFX0hBTkRMRSddO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gcGFzc1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFwcGx5TWFudWFsT3ZlcnJpZGVzKHBhcmFtcz86IExvYWRDb25maWdQYXJhbXMpIHtcbiAgICBpZiAocGFyYW1zPy5hcGlCYXNlKSB7XG4gICAgICB0aGlzLl9jb25maWcuYXBpQmFzZSA9IHBhcmFtcz8uYXBpQmFzZTtcbiAgICB9XG4gICAgaWYgKHBhcmFtcz8uYXBwQmFzZSkge1xuICAgICAgdGhpcy5fY29uZmlnLmFwcEJhc2UgPSBwYXJhbXM/LmFwcEJhc2U7XG4gICAgfVxuICAgIGlmIChwYXJhbXM/LndlYkJhc2UpIHtcbiAgICAgIHRoaXMuX2NvbmZpZy53ZWJCYXNlID0gcGFyYW1zPy53ZWJCYXNlO1xuICAgIH1cbiAgICBpZiAocGFyYW1zPy5hcGlLZXkpIHtcbiAgICAgIHRoaXMuX2NvbmZpZy5hcGlLZXkgPSBwYXJhbXM/LmFwaUtleTtcbiAgICB9XG4gICAgaWYgKHBhcmFtcz8ud29ya3NwYWNlKSB7XG4gICAgICB0aGlzLl9jb25maWcud29ya3NwYWNlSGFuZGxlID0gcGFyYW1zPy53b3Jrc3BhY2U7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbG9hZChwYXJhbXM/OiBMb2FkQ29uZmlnUGFyYW1zKTogUHJvbWlzZTxDb25maWd1cmF0aW9uPiB7XG4gICAgYXdhaXQgdGhpcy5wcmVwYXJlKCk7XG4gICAgdGhpcy5jbGVhcigpO1xuXG4gICAgLy8gRmlyc3Qgc2V0IHRoZSBwcm9maWxlLlxuICAgIGlmICh0eXBlb2YgcHJvY2VzcyAhPSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgcHJvY2Vzcy5lbnYgIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGlmIChwcm9jZXNzLmVudlsnU1RFQU1TSElQX1BST0ZJTEUnXSkge1xuICAgICAgICB0aGlzLl9jb25maWcucHJvZmlsZSA9IHByb2Nlc3MuZW52WydTVEVBTVNISVBfUFJPRklMRSddO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocGFyYW1zPy5wcm9maWxlKSB7XG4gICAgICB0aGlzLl9jb25maWcucHJvZmlsZSA9IHBhcmFtcz8ucHJvZmlsZTtcbiAgICB9XG5cbiAgICAvLyBUaGVuIGxvYWQgZnJvbSBhIGZpbGUgaWYgcHJvdmlkZWRcbiAgICBpZiAocGFyYW1zPy5jb25maWdGaWxlKSB7XG4gICAgICBjb25zdCBmb3VuZCA9IGF3YWl0IHRoaXMubG9hZEZyb21GaWxlKFxuICAgICAgICBwYXJhbXM/LmNvbmZpZ0ZpbGUsXG4gICAgICAgIHRoaXMuX2NvbmZpZy5wcm9maWxlXG4gICAgICApO1xuICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICB0aHJvdyBgQ29uZmlndXJhdGlvbiBwYXRoIHByb3ZpZGVkIGJ1dCBubyBjb25maWd1cmF0aW9uIGZvdW5kIGF0ICcke3BhcmFtcz8uY29uZmlnRmlsZX0nYDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy50cnlBdXRvZmluZGluZ0ZpbGVzKHRoaXMuX2NvbmZpZy5wcm9maWxlKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBFbnYgVmFyaWFibGVzXG4gICAgYXdhaXQgdGhpcy5sb2FkRW52VmFycygpO1xuXG4gICAgLy8gQXBwbHkgbWFudWFsIG92ZXJyaWRlc1xuICAgIHRoaXMuYXBwbHlNYW51YWxPdmVycmlkZXMocGFyYW1zKTtcblxuICAgIC8vIEZpeCB0aGUgYmFzZVxuICAgIGlmICh0aGlzLl9jb25maWcuYXBpQmFzZSkge1xuICAgICAgaWYgKHRoaXMuX2NvbmZpZy5hcGlCYXNlW3RoaXMuX2NvbmZpZy5hcGlCYXNlLmxlbmd0aCAtIDFdICE9ICcvJykge1xuICAgICAgICB0aGlzLl9jb25maWcuYXBpQmFzZSA9IGAke3RoaXMuX2NvbmZpZy5hcGlCYXNlfS9gO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5fY29uZmlnLmFwcEJhc2UpIHtcbiAgICAgIGlmICh0aGlzLl9jb25maWcuYXBwQmFzZVt0aGlzLl9jb25maWcuYXBwQmFzZS5sZW5ndGggLSAxXSAhPSAnLycpIHtcbiAgICAgICAgdGhpcy5fY29uZmlnLmFwcEJhc2UgPSBgJHt0aGlzLl9jb25maWcuYXBwQmFzZX0vYDtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMuX2NvbmZpZy53ZWJCYXNlKSB7XG4gICAgICBpZiAodGhpcy5fY29uZmlnLndlYkJhc2VbdGhpcy5fY29uZmlnLndlYkJhc2UubGVuZ3RoIC0gMV0gIT0gJy8nKSB7XG4gICAgICAgIHRoaXMuX2NvbmZpZy53ZWJCYXNlID0gYCR7dGhpcy5fY29uZmlnLndlYkJhc2V9L2A7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9jb25maWc7XG4gIH1cblxuICBhc3luYyBtb2RpZnlDb25maWd1cmF0aW9uKFxuICAgIHZhbHVlczogU2F2ZUNvbmZpZ1BhcmFtcyxcbiAgICBwcm9maWxlPzogc3RyaW5nLFxuICAgIGNvbmZpZ0ZpbGU/OiBzdHJpbmdcbiAgKSB7XG4gICAgYXdhaXQgdGhpcy5wcmVwYXJlKCk7XG4gICAgaWYgKFxuICAgICAgIWlzTm9kZSgpIHx8XG4gICAgICB0eXBlb2YgdGhpcy5fcmVhZEZpbGUgPT0gJ3VuZGVmaW5lZCcgfHxcbiAgICAgIHR5cGVvZiB0aGlzLl93cml0ZUZpbGUgPT0gJ3VuZGVmaW5lZCdcbiAgICApIHtcbiAgICAgIHRocm93ICdDb3VsZCBub3Qgc2F2ZSBjb25maWd1cmF0aW9uLCBubyBmaWxlc3lzdGVtIGZvdW5kLic7XG4gICAgfVxuXG4gICAgY29uc3Qgb3MgPSBhd2FpdCBpbXBvcnQoJ29zJyk7XG4gICAgY29uc3QgcGF0aCA9IGF3YWl0IGltcG9ydCgncGF0aCcpO1xuXG4gICAgLy8gTG9hZCB0aGUgY29uZmlnIGZpbGUgZnJvbSB0aGUgZ2l2ZW4gcGF0aCBvciB0aGUgZGVmYXVsdCBwYXRoXG4gICAgLy8gSWYgdGhlIGZpbGUgZG9lcyBub3QgZXhpc3QsIGNyZWF0ZSBhIG5ldyBjb25maWdcblxuICAgIGlmICh0eXBlb2YgY29uZmlnRmlsZSA9PT0gJ3N0cmluZycgJiYgY29uZmlnRmlsZS50cmltKCkgPT09ICcnKSB7XG4gICAgICB0aHJvdyAnQW4gaW52YWxpZCBzYXZlIGxvY2F0aW9uIHdhcyBnaXZlbi4nO1xuICAgIH1cblxuICAgIGlmICghY29uZmlnRmlsZSkge1xuICAgICAgY29uZmlnRmlsZSA9IHBhdGguam9pbihvcy5ob21lZGlyKCksIENPTkZJR19GSUxFTkFNRSk7XG4gICAgfVxuICAgIGNvbnN0IHN0ciA9IHRoaXMuX3JlYWRGaWxlKGNvbmZpZ0ZpbGUpO1xuICAgIGxldCBuZXdDb25maWc6IENvbmZpZ3VyYXRpb24gPSB7IC4uLkRFRkFVTFRfQ09ORklHIH07XG4gICAgaWYgKHN0cikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgbmV3Q29uZmlnID0gSlNPTi5wYXJzZShzdHIpIGFzIENvbmZpZ3VyYXRpb247XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vIElmIHRoZXJlIGlzIGFuIGlzc3VlIHdpdGggdGhlIGNvbmZpZywgd2UganVzdCB1c2UgdGhlIGRlZmF1bHRcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBOb3cgc2V0IHRoZSBkZXNpcmVkIHZhbHVlcy4gSWYgdGhlcmUgaXMgYSBwcm9maWxlLCBvbmx5IGRvIHRoaXMgdG8gdGhhdFxuICAgIC8vIHByb2ZpbGUuIE90aGVyd2lzZSwgb3ZlcnJpZGUgdGhlIGZpZWxkcy5cbiAgICBpZiAocHJvZmlsZSkge1xuICAgICAgaWYgKCFuZXdDb25maWcucHJvZmlsZXMpIHtcbiAgICAgICAgbmV3Q29uZmlnLnByb2ZpbGVzID0ge307IC8vIEFkZCB0aGUgcHJvZmlsZXMgZmllbGQgaWYgaXQgZG9lcyBub3QgZXhpc3RcbiAgICAgIH1cbiAgICAgIGlmICghT2JqZWN0LmtleXMobmV3Q29uZmlnLnByb2ZpbGVzKS5pbmNsdWRlcyhwcm9maWxlKSkge1xuICAgICAgICBuZXdDb25maWcucHJvZmlsZXNbcHJvZmlsZV0gPSB7IHByb2ZpbGU6IHByb2ZpbGUgfTsgLy8gQWRkcyB0aGlzIHNwZWNpZmljIHByb2ZpbGVcbiAgICAgIH1cbiAgICAgIE9iamVjdC5rZXlzKHZhbHVlcykuZm9yRWFjaCgoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgaWYgKGtleSA9PT0gJ3Byb2ZpbGVzJykge1xuICAgICAgICAgIHRocm93ICdDYW5ub3Qgc2F2ZSBhIHByb2ZpbGVzIGxpc3Qgd2l0aGluIGEgcHJvZmlsZSBpdHNlbGYuIEEgYHByb2ZpbGVzYCBtb2RpZmljYXRpb24gaXMgb25seSBhbGxvd2VkIG9uIHRoZSBkZWZhdWx0IGNvbmZpZyAoaS5lLiBsZWF2ZSBgcHJvZmlsZWAgYmxhbmspJztcbiAgICAgICAgfVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgbmV3Q29uZmlnLnByb2ZpbGVzW3Byb2ZpbGVdW2tleV0gPVxuICAgICAgICAgIHZhbHVlc1trZXkgYXMga2V5b2YgU2F2ZUNvbmZpZ1BhcmFtc107XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgT2JqZWN0LmtleXModmFsdWVzKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIG5ld0NvbmZpZ1trZXldID0gdmFsdWVzW2tleSBhcyBrZXlvZiBTYXZlQ29uZmlnUGFyYW1zXTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEZpbmFsbHksIHNhdmUgdGhlIGNvbmZpZ3VyYXRpb25cbiAgICB0aGlzLl93cml0ZUZpbGUoY29uZmlnRmlsZSwgSlNPTi5zdHJpbmdpZnkobmV3Q29uZmlnLCB1bmRlZmluZWQsIDIpKTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZENvbmZpZ3VyYXRpb24oXG4gIHBhcmFtcz86IExvYWRDb25maWdQYXJhbXNcbik6IFByb21pc2U8Q29uZmlndXJhdGlvbj4ge1xuICBjb25zdCBjb25maWdNYW5hZ2VyID0gbmV3IENvbmZpZ01hbmFnZXIoKTtcbiAgcmV0dXJuIGF3YWl0IGNvbmZpZ01hbmFnZXIubG9hZChwYXJhbXMpO1xufVxuXG4vKipcbiAqIE1vZGlmaWVzIG9yIGNyZWF0ZXMgYSBjb25maWd1cmF0aW9uIGdpdmVuIHRoZSBkZXNpcmVkIHZhbHVlcy4gQWxsb3dzXG4gKiBtb2RpZnlpbmcgdGhlIGRlZmF1bHQgcHJvZmlsZSwgb3IgbW9kaWZ5aW5nIGluZGl2aWR1YWwgcHJvZmlsZXMgYnlcbiAqIHByb3ZpZGluZyBhIGBwcm9maWxlYCBwYXJhbWV0ZXIuIElmIG5vIGNvbmZpZ0ZpbGUgaXMgZ2l2ZW4sIGRlZmF1bHRzXG4gKiB0byB0aGUgZGVmYXVsdCBsb2NhdGlvbiAoaG9tZSBkaXJlY3RvcnkgLyAuc3RlYW1zaGlwLmpzb24pLlxuICogTm90ZTogSWYgdGhlIGNvbmZpZ0ZpbGUgYWxyZWFkeSBleGlzdHMsIHRoZSBleGlzdGluZyBmaWxlIGlzIG1vZGlmaWVkLlxuICogICAgICAgSWYgdGhlIGZpbGUgaXMgY29ycnVwdCBvciBtaXNzaW5nLCBhIG5ldyBmaWxlIGlzIGNyZWF0ZWRcbiAqIEBwYXJhbSB2YWx1ZXMgVGhlIHZhbHVlcyB0byBzYXZlIHRvIHRoZSBjb25maWcgb3IgcHJvZmlsZVxuICogQHBhcmFtIHByb2ZpbGUgKE9wdGlvbmFsKSBUaGUgcHJvZmlsZSB0byBvdmVycmlkZS4gRGVmYXVsdHMgdG8gdGhlIGRlZmF1bHRcbiAqICAgICAgICAgICAgICAgIHByb2ZpbGUuXG4gKiBAcGFyYW0gY29uZmlnRmlsZSAoT3B0aW9uYWwpIFRoZSBhYnNvbHV0ZSBsb2NhdGlvbiB0byB0aGUgZmlsZSB0byBzYXZlXG4gKiAgICAgICAgICAgICAgICAgICB0by4gRGVmYXVsdHMgdG8gKGhvbWUgZGlyZWN0b3J5IC8gLnN0ZWFtc2hpcC5qc29uKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2F2ZUNvbmZpZ3VyYXRpb24oXG4gIHZhbHVlczogU2F2ZUNvbmZpZ1BhcmFtcyxcbiAgcHJvZmlsZT86IHN0cmluZyxcbiAgY29uZmlnRmlsZT86IHN0cmluZ1xuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IGNvbmZpZ01hbmFnZXIgPSBuZXcgQ29uZmlnTWFuYWdlcigpO1xuICBhd2FpdCBjb25maWdNYW5hZ2VyLm1vZGlmeUNvbmZpZ3VyYXRpb24odmFsdWVzLCBwcm9maWxlLCBjb25maWdGaWxlKTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBcUM7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUF3QzlCLElBQU1BLGNBSVosR0FBRztFQUNGQyxPQUFPLEVBQUUsbUNBQW1DO0VBQzVDQyxPQUFPLEVBQUUsd0JBQXdCO0VBQ2pDQyxPQUFPLEVBQUU7QUFDWCxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFTyxJQUFNQyxlQUFlLEdBQUcsaUJBQWlCO0FBQUM7QUFBQSxJQUUzQ0MsYUFBYTtFQUFBO0lBQUE7SUFBQSxvREFDbURDLFNBQVM7SUFBQSxxREFFM0VBLFNBQVM7SUFBQSw0REFDbUIsRUFBRTtJQUFBLGtEQUNQ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