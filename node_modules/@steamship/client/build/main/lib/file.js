"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _typeof = require("@babel/runtime/helpers/typeof");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.File = void 0;
exports.readFile = readFile;
var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _block = require("./block.js");
var _tag = require("./tag.js");
function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }
function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
var generateRandomString = function generateRandomString() {
  var length = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 6;
  return Math.random().toString(20).substr(2, length);
};
function readFile(_x) {
  return _readFile.apply(this, arguments);
}
function _readFile() {
  _readFile = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee9(filename) {
    var fs, util, readFile, content;
    return _regenerator["default"].wrap(function _callee9$(_context9) {
      while (1) switch (_context9.prev = _context9.next) {
        case 0:
          _context9.next = 2;
          return Promise.resolve().then(function () {
            return _interopRequireWildcard(require('fs'));
          });
        case 2:
          fs = _context9.sent;
          _context9.next = 5;
          return Promise.resolve().then(function () {
            return _interopRequireWildcard(require('util'));
          });
        case 5:
          util = _context9.sent;
          readFile = util.promisify(fs.readFile);
          _context9.next = 9;
          return readFile(filename);
        case 9:
          content = _context9.sent;
          return _context9.abrupt("return", content);
        case 11:
        case "end":
          return _context9.stop();
      }
    }, _callee9);
  }));
  return _readFile.apply(this, arguments);
}
var _EXPECT = function _EXPECT(client, data) {
  return new File(client, data);
};
var _EXPECT_LIST = function _EXPECT_LIST(client, data) {
  return {
    files: data.files.map(function (x) {
      return _EXPECT(client, x);
    })
  };
};
var File = /*#__PURE__*/function () {
  function File(client, params) {
    (0, _classCallCheck2["default"])(this, File);
    (0, _defineProperty2["default"])(this, "id", void 0);
    (0, _defineProperty2["default"])(this, "handle", void 0);
    (0, _defineProperty2["default"])(this, "mimeType", void 0);
    (0, _defineProperty2["default"])(this, "userId", void 0);
    (0, _defineProperty2["default"])(this, "workspaceId", void 0);
    (0, _defineProperty2["default"])(this, "blocks", void 0);
    (0, _defineProperty2["default"])(this, "tags", void 0);
    (0, _defineProperty2["default"])(this, "client", void 0);
    this.client = client;
    this.id = params.id;
    this.handle = params.handle;
    this.mimeType = params.mimeType;
    this.workspaceId = params.workspaceId;
    this.userId = params.userId;
    this.blocks = [];
    if (params.blocks) {
      var _iterator = _createForOfIteratorHelper(params.blocks),
        _step;
      try {
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          var block = _step.value;
          if (block instanceof _block.Block) {
            this.blocks.push(block);
          } else {
            this.blocks.push(new _block.Block(client, block));
          }
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
    }
    this.tags = [];
    if (params.tags) {
      var _iterator2 = _createForOfIteratorHelper(params.tags),
        _step2;
      try {
        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
          var tag = _step2.value;
          if (tag instanceof _tag.Tag) {
            this.tags.push(tag);
          } else {
            this.tags.push(new _tag.Tag(client, tag));
          }
        }
      } catch (err) {
        _iterator2.e(err);
      } finally {
        _iterator2.f();
      }
    }
  }
  (0, _createClass2["default"])(File, [{
    key: "delete",
    value: function () {
      var _delete2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee(config) {
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return this.client.post('file/delete', {
                id: this.id
              }, _objectSpread({
                expect: _EXPECT,
                responsePath: 'file'
              }, config));
            case 2:
              return _context.abrupt("return", _context.sent);
            case 3:
            case "end":
              return _context.stop();
          }
        }, _callee, this);
      }));
      function _delete(_x2) {
        return _delete2.apply(this, arguments);
      }
      return _delete;
    }()
  }, {
    key: "raw",
    value: function () {
      var _raw = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2(config) {
        var resp;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              _context2.next = 2;
              return this.client.post('file/raw', {
                id: this.id
              }, _objectSpread(_objectSpread({}, config), {}, {
                rawResponse: true
              }));
            case 2:
              resp = _context2.sent;
              return _context2.abrupt("return", resp.data);
            case 4:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this);
      }));
      function raw(_x3) {
        return _raw.apply(this, arguments);
      }
      return raw;
    }()
  }, {
    key: "clear",
    value: function () {
      var _clear = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(config) {
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              _context3.next = 2;
              return this.client.post('file/clear', {
                id: this.id
              }, _objectSpread({
                expect: _EXPECT,
                responsePath: 'config'
              }, config));
            case 2:
              return _context3.abrupt("return", _context3.sent);
            case 3:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this);
      }));
      function clear(_x4) {
        return _clear.apply(this, arguments);
      }
      return clear;
    }()
  }], [{
    key: "create",
    value: function () {
      var _create = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(client, params, config) {
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) switch (_context4.prev = _context4.next) {
            case 0:
              return _context4.abrupt("return", File.upload(client, params, config));
            case 1:
            case "end":
              return _context4.stop();
          }
        }, _callee4);
      }));
      function create(_x5, _x6, _x7) {
        return _create.apply(this, arguments);
      }
      return create;
    }()
  }, {
    key: "upload",
    value: function () {
      var _upload = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5(client, params, config) {
        var contentIsFile, buffer;
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) switch (_context5.prev = _context5.next) {
            case 0:
              if (!(typeof params.content == 'undefined')) {
                _context5.next = 2;
                break;
              }
              throw Error('Content must be provided');
            case 2:
              contentIsFile = !(params.content instanceof String);
              buffer = undefined;
              if (contentIsFile) {
                params.type = 'file';
                buffer = params.content;
                delete params.content;
              } else {
                params.type = 'value';
              }
              _context5.next = 7;
              return client.post('file/create', {
                type: params.type,
                filename: params.filename,
                handle: params.handle,
                tags: params.tags,
                value: params.content,
                mimeType: params.mimeType,
                workspaceId: params.workspaceId
              }, _objectSpread(_objectSpread({}, config), {}, {
                expect: _EXPECT,
                responsePath: 'file',
                file: buffer,
                // Filename MUST be non-undefined! Otherwise the request library will
                // not work.
                filename: params.filename || params.handle || generateRandomString()
              }));
            case 7:
              return _context5.abrupt("return", _context5.sent);
            case 8:
            case "end":
              return _context5.stop();
          }
        }, _callee5);
      }));
      function upload(_x8, _x9, _x10) {
        return _upload.apply(this, arguments);
      }
      return upload;
    }()
  }, {
    key: "list",
    value: function () {
      var _list = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6(client, params, config) {
        return _regenerator["default"].wrap(function _callee6$(_context6) {
          while (1) switch (_context6.prev = _context6.next) {
            case 0:
              _context6.next = 2;
              return client.post('file/list', _objectSpread({}, params), _objectSpread({
                expect: _EXPECT_LIST
              }, config));
            case 2:
              return _context6.abrupt("return", _context6.sent);
            case 3:
            case "end":
              return _context6.stop();
          }
        }, _callee6);
      }));
      function list(_x11, _x12, _x13) {
        return _list.apply(this, arguments);
      }
      return list;
    }()
  }, {
    key: "query",
    value: function () {
      var _query = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee7(client, tagFilterQuery, config) {
        return _regenerator["default"].wrap(function _callee7$(_context7) {
          while (1) switch (_context7.prev = _context7.next) {
            case 0:
              _context7.next = 2;
              return client.post('file/query', {
                tagFilterQuery: tagFilterQuery
              }, _objectSpread({
                expect: _EXPECT_LIST
              }, config));
            case 2:
              return _context7.abrupt("return", _context7.sent);
            case 3:
            case "end":
              return _context7.stop();
          }
        }, _callee7);
      }));
      function query(_x14, _x15, _x16) {
        return _query.apply(this, arguments);
      }
      return query;
    }()
  }, {
    key: "get",
    value: function () {
      var _get = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee8(client, params, config) {
        return _regenerator["default"].wrap(function _callee8$(_context8) {
          while (1) switch (_context8.prev = _context8.next) {
            case 0:
              _context8.next = 2;
              return client.post('file/get', _objectSpread({}, params), _objectSpread({
                expect: _EXPECT,
                responsePath: 'file'
              }, config));
            case 2:
              return _context8.abrupt("return", _context8.sent);
            case 3:
            case "end":
              return _context8.stop();
          }
        }, _callee8);
      }));
      function get(_x17, _x18, _x19) {
        return _get.apply(this, arguments);
      }
      return get;
    }()
  }]);
  return File;
}();
exports.File = File;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZW5lcmF0ZVJhbmRvbVN0cmluZyIsImxlbmd0aCIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsInJlYWRGaWxlIiwiZmlsZW5hbWUiLCJmcyIsInV0aWwiLCJwcm9taXNpZnkiLCJjb250ZW50IiwiX0VYUEVDVCIsImNsaWVudCIsImRhdGEiLCJGaWxlIiwiX0VYUEVDVF9MSVNUIiwiZmlsZXMiLCJtYXAiLCJ4IiwicGFyYW1zIiwiaWQiLCJoYW5kbGUiLCJtaW1lVHlwZSIsIndvcmtzcGFjZUlkIiwidXNlcklkIiwiYmxvY2tzIiwiYmxvY2siLCJCbG9jayIsInB1c2giLCJ0YWdzIiwidGFnIiwiVGFnIiwiY29uZmlnIiwicG9zdCIsImV4cGVjdCIsInJlc3BvbnNlUGF0aCIsInJhd1Jlc3BvbnNlIiwicmVzcCIsInVwbG9hZCIsIkVycm9yIiwiY29udGVudElzRmlsZSIsIlN0cmluZyIsImJ1ZmZlciIsInVuZGVmaW5lZCIsInR5cGUiLCJ2YWx1ZSIsImZpbGUiLCJ0YWdGaWx0ZXJRdWVyeSJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvZmlsZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBeGlvc1Jlc3BvbnNlIH0gZnJvbSAnYXhpb3MnO1xuXG5pbXBvcnQgeyBCbG9jaywgQmxvY2tQYXJhbXMgfSBmcm9tICcuL2Jsb2NrLmpzJztcbmltcG9ydCB7IEFsbG93ZWRGaWxlVHlwZXMsIElBcGlCYXNlIH0gZnJvbSAnLi9zaGFyZWQvQmFzZUludGVyZmFjZXMuanMnO1xuaW1wb3J0IHsgQ29uZmlndXJhdGlvbiB9IGZyb20gJy4vc2hhcmVkL0NvbmZpZ3VyYXRpb24uanMnO1xuaW1wb3J0IHsgR2V0UGFyYW1zIH0gZnJvbSAnLi9zaGFyZWQvUmVxdWVzdHMuanMnO1xuaW1wb3J0IHsgVGFnLCBUYWdQYXJhbXMgfSBmcm9tICcuL3RhZy5qcyc7XG5pbXBvcnQgeyBUYXNrIH0gZnJvbSAnLi90YXNrLmpzJztcblxuY29uc3QgZ2VuZXJhdGVSYW5kb21TdHJpbmcgPSAobGVuZ3RoID0gNikgPT5cbiAgTWF0aC5yYW5kb20oKS50b1N0cmluZygyMCkuc3Vic3RyKDIsIGxlbmd0aCk7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWFkRmlsZShmaWxlbmFtZTogc3RyaW5nKTogUHJvbWlzZTxCdWZmZXI+IHtcbiAgY29uc3QgZnMgPSBhd2FpdCBpbXBvcnQoJ2ZzJyk7XG4gIGNvbnN0IHV0aWwgPSBhd2FpdCBpbXBvcnQoJ3V0aWwnKTtcbiAgY29uc3QgcmVhZEZpbGUgPSB1dGlsLnByb21pc2lmeShmcy5yZWFkRmlsZSk7XG4gIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCByZWFkRmlsZShmaWxlbmFtZSk7XG4gIHJldHVybiBjb250ZW50O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbGVMaXN0IHtcbiAgZmlsZXM6IEZpbGVbXTtcbn1cblxuY29uc3QgX0VYUEVDVCA9IChjbGllbnQ6IElBcGlCYXNlLCBkYXRhOiB1bmtub3duKSA9PiB7XG4gIHJldHVybiBuZXcgRmlsZShjbGllbnQsIGRhdGEgYXMgRmlsZVBhcmFtcyk7XG59O1xuXG5jb25zdCBfRVhQRUNUX0xJU1QgPSAoY2xpZW50OiBJQXBpQmFzZSwgZGF0YTogdW5rbm93bikgPT4ge1xuICByZXR1cm4ge1xuICAgIGZpbGVzOiAoKGRhdGEgYXMgYW55KS5maWxlcyBhcyBBcnJheTxhbnk+KS5tYXAoKHgpID0+IF9FWFBFQ1QoY2xpZW50LCB4KSksXG4gIH07XG59O1xuXG5leHBvcnQgaW50ZXJmYWNlIEZpbGVQYXJhbXMge1xuICBpZD86IHN0cmluZztcbiAgaGFuZGxlPzogc3RyaW5nO1xuICBtaW1lVHlwZT86IHN0cmluZztcbiAgd29ya3NwYWNlSWQ/OiBzdHJpbmc7XG4gIHRlbmFudElkPzogc3RyaW5nO1xuICB1c2VySWQ/OiBzdHJpbmc7XG4gIGJsb2Nrcz86IEJsb2NrUGFyYW1zW10gfCBCbG9ja1tdO1xuICB0YWdzPzogVGFnUGFyYW1zW10gfCBUYWdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGxvYWRQYXJhbXMge1xuICBmaWxlbmFtZT86IHN0cmluZztcbiAgY29udGVudD86IEFsbG93ZWRGaWxlVHlwZXM7XG4gIHR5cGU/OiAnZmlsZScgfCAndXJsJyB8ICd2YWx1ZSc7XG4gIHRhZ3M/OiBUYWdQYXJhbXNbXTtcbiAgaGFuZGxlPzogc3RyaW5nO1xuICBtaW1lVHlwZT86IHN0cmluZztcbiAgd29ya3NwYWNlSWQ/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBGaWxlIHtcbiAgaWQ/OiBzdHJpbmc7XG4gIGhhbmRsZT86IHN0cmluZztcbiAgbWltZVR5cGU/OiBzdHJpbmc7XG4gIHVzZXJJZD86IHN0cmluZztcbiAgd29ya3NwYWNlSWQ/OiBzdHJpbmc7XG4gIGJsb2Nrcz86IEJsb2NrW107XG4gIHRhZ3M/OiBUYWdbXTtcbiAgY2xpZW50OiBJQXBpQmFzZTtcblxuICBjb25zdHJ1Y3RvcihjbGllbnQ6IElBcGlCYXNlLCBwYXJhbXM6IEZpbGVQYXJhbXMpIHtcbiAgICB0aGlzLmNsaWVudCA9IGNsaWVudDtcbiAgICB0aGlzLmlkID0gcGFyYW1zLmlkO1xuICAgIHRoaXMuaGFuZGxlID0gcGFyYW1zLmhhbmRsZTtcbiAgICB0aGlzLm1pbWVUeXBlID0gcGFyYW1zLm1pbWVUeXBlO1xuICAgIHRoaXMud29ya3NwYWNlSWQgPSBwYXJhbXMud29ya3NwYWNlSWQ7XG4gICAgdGhpcy51c2VySWQgPSBwYXJhbXMudXNlcklkO1xuXG4gICAgdGhpcy5ibG9ja3MgPSBbXTtcbiAgICBpZiAocGFyYW1zLmJsb2Nrcykge1xuICAgICAgZm9yIChjb25zdCBibG9jayBvZiBwYXJhbXMuYmxvY2tzKSB7XG4gICAgICAgIGlmIChibG9jayBpbnN0YW5jZW9mIEJsb2NrKSB7XG4gICAgICAgICAgdGhpcy5ibG9ja3MucHVzaChibG9jayk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5ibG9ja3MucHVzaChuZXcgQmxvY2soY2xpZW50LCBibG9jaykpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy50YWdzID0gW107XG4gICAgaWYgKHBhcmFtcy50YWdzKSB7XG4gICAgICBmb3IgKGNvbnN0IHRhZyBvZiBwYXJhbXMudGFncykge1xuICAgICAgICBpZiAodGFnIGluc3RhbmNlb2YgVGFnKSB7XG4gICAgICAgICAgdGhpcy50YWdzLnB1c2godGFnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnRhZ3MucHVzaChuZXcgVGFnKGNsaWVudCwgdGFnKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgY3JlYXRlKFxuICAgIGNsaWVudDogSUFwaUJhc2UsXG4gICAgcGFyYW1zOiBVcGxvYWRQYXJhbXMsXG4gICAgY29uZmlnPzogQ29uZmlndXJhdGlvblxuICApOiBQcm9taXNlPFRhc2s8RmlsZT4+IHtcbiAgICByZXR1cm4gRmlsZS51cGxvYWQoY2xpZW50LCBwYXJhbXMsIGNvbmZpZyk7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgdXBsb2FkKFxuICAgIGNsaWVudDogSUFwaUJhc2UsXG4gICAgcGFyYW1zOiBVcGxvYWRQYXJhbXMsXG4gICAgY29uZmlnPzogQ29uZmlndXJhdGlvblxuICApOiBQcm9taXNlPFRhc2s8RmlsZT4+IHtcbiAgICBpZiAodHlwZW9mIHBhcmFtcy5jb250ZW50ID09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aHJvdyBFcnJvcignQ29udGVudCBtdXN0IGJlIHByb3ZpZGVkJyk7XG4gICAgfVxuXG4gICAgY29uc3QgY29udGVudElzRmlsZSA9ICEoKHBhcmFtcy5jb250ZW50IGFzIGFueSkgaW5zdGFuY2VvZiBTdHJpbmcpO1xuXG4gICAgbGV0IGJ1ZmZlcjogQWxsb3dlZEZpbGVUeXBlcyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcblxuICAgIGlmIChjb250ZW50SXNGaWxlKSB7XG4gICAgICBwYXJhbXMudHlwZSA9ICdmaWxlJztcbiAgICAgIGJ1ZmZlciA9IHBhcmFtcy5jb250ZW50IGFzIGFueTtcbiAgICAgIGRlbGV0ZSBwYXJhbXMuY29udGVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgcGFyYW1zLnR5cGUgPSAndmFsdWUnO1xuICAgIH1cblxuICAgIHJldHVybiAoYXdhaXQgY2xpZW50LnBvc3QoXG4gICAgICAnZmlsZS9jcmVhdGUnLFxuICAgICAge1xuICAgICAgICB0eXBlOiBwYXJhbXMudHlwZSxcbiAgICAgICAgZmlsZW5hbWU6IHBhcmFtcy5maWxlbmFtZSxcbiAgICAgICAgaGFuZGxlOiBwYXJhbXMuaGFuZGxlLFxuICAgICAgICB0YWdzOiBwYXJhbXMudGFncyxcbiAgICAgICAgdmFsdWU6IHBhcmFtcy5jb250ZW50LFxuICAgICAgICBtaW1lVHlwZTogcGFyYW1zLm1pbWVUeXBlLFxuICAgICAgICB3b3Jrc3BhY2VJZDogcGFyYW1zLndvcmtzcGFjZUlkLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgLi4uY29uZmlnLFxuICAgICAgICBleHBlY3Q6IF9FWFBFQ1QsXG4gICAgICAgIHJlc3BvbnNlUGF0aDogJ2ZpbGUnLFxuICAgICAgICBmaWxlOiBidWZmZXIsXG4gICAgICAgIC8vIEZpbGVuYW1lIE1VU1QgYmUgbm9uLXVuZGVmaW5lZCEgT3RoZXJ3aXNlIHRoZSByZXF1ZXN0IGxpYnJhcnkgd2lsbFxuICAgICAgICAvLyBub3Qgd29yay5cbiAgICAgICAgZmlsZW5hbWU6IHBhcmFtcy5maWxlbmFtZSB8fCBwYXJhbXMuaGFuZGxlIHx8IGdlbmVyYXRlUmFuZG9tU3RyaW5nKCksXG4gICAgICB9XG4gICAgKSkgYXMgVGFzazxGaWxlPjtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZShjb25maWc/OiBDb25maWd1cmF0aW9uKTogUHJvbWlzZTxUYXNrPEZpbGU+PiB7XG4gICAgcmV0dXJuIChhd2FpdCB0aGlzLmNsaWVudC5wb3N0KFxuICAgICAgJ2ZpbGUvZGVsZXRlJyxcbiAgICAgIHtcbiAgICAgICAgaWQ6IHRoaXMuaWQsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBleHBlY3Q6IF9FWFBFQ1QsXG4gICAgICAgIHJlc3BvbnNlUGF0aDogJ2ZpbGUnLFxuICAgICAgICAuLi5jb25maWcsXG4gICAgICB9XG4gICAgKSkgYXMgVGFzazxGaWxlPjtcbiAgfVxuXG4gIGFzeW5jIHJhdyhjb25maWc/OiBDb25maWd1cmF0aW9uKTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zdCByZXNwID0gKGF3YWl0IHRoaXMuY2xpZW50LnBvc3QoXG4gICAgICAnZmlsZS9yYXcnLFxuICAgICAge1xuICAgICAgICBpZDogdGhpcy5pZCxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIC4uLmNvbmZpZyxcbiAgICAgICAgcmF3UmVzcG9uc2U6IHRydWUsXG4gICAgICB9XG4gICAgKSkgYXMgQXhpb3NSZXNwb25zZTtcbiAgICByZXR1cm4gcmVzcC5kYXRhO1xuICB9XG5cbiAgYXN5bmMgY2xlYXIoY29uZmlnPzogQ29uZmlndXJhdGlvbik6IFByb21pc2U8VGFzazxGaWxlPj4ge1xuICAgIHJldHVybiAoYXdhaXQgdGhpcy5jbGllbnQucG9zdChcbiAgICAgICdmaWxlL2NsZWFyJyxcbiAgICAgIHtcbiAgICAgICAgaWQ6IHRoaXMuaWQsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBleHBlY3Q6IF9FWFBFQ1QsXG4gICAgICAgIHJlc3BvbnNlUGF0aDogJ2NvbmZpZycsXG4gICAgICAgIC4uLmNvbmZpZyxcbiAgICAgIH1cbiAgICApKSBhcyBUYXNrPEZpbGU+O1xuICB9XG5cbiAgc3RhdGljIGFzeW5jIGxpc3QoXG4gICAgY2xpZW50OiBJQXBpQmFzZSxcbiAgICBwYXJhbXM/OiBHZXRQYXJhbXMsXG4gICAgY29uZmlnPzogQ29uZmlndXJhdGlvblxuICApOiBQcm9taXNlPFRhc2s8RmlsZUxpc3Q+PiB7XG4gICAgcmV0dXJuIChhd2FpdCBjbGllbnQucG9zdChcbiAgICAgICdmaWxlL2xpc3QnLFxuICAgICAgeyAuLi5wYXJhbXMgfSxcbiAgICAgIHtcbiAgICAgICAgZXhwZWN0OiBfRVhQRUNUX0xJU1QsXG4gICAgICAgIC4uLmNvbmZpZyxcbiAgICAgIH1cbiAgICApKSBhcyBUYXNrPEZpbGVMaXN0PjtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBxdWVyeShcbiAgICBjbGllbnQ6IElBcGlCYXNlLFxuICAgIHRhZ0ZpbHRlclF1ZXJ5OiBzdHJpbmcsXG4gICAgY29uZmlnPzogQ29uZmlndXJhdGlvblxuICApOiBQcm9taXNlPFRhc2s8RmlsZUxpc3Q+PiB7XG4gICAgcmV0dXJuIChhd2FpdCBjbGllbnQucG9zdChcbiAgICAgICdmaWxlL3F1ZXJ5JyxcbiAgICAgIHsgdGFnRmlsdGVyUXVlcnkgfSxcbiAgICAgIHtcbiAgICAgICAgZXhwZWN0OiBfRVhQRUNUX0xJU1QsXG4gICAgICAgIC4uLmNvbmZpZyxcbiAgICAgIH1cbiAgICApKSBhcyBUYXNrPEZpbGVMaXN0PjtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBnZXQoXG4gICAgY2xpZW50OiBJQXBpQmFzZSxcbiAgICBwYXJhbXM/OiBHZXRQYXJhbXMsXG4gICAgY29uZmlnPzogQ29uZmlndXJhdGlvblxuICApOiBQcm9taXNlPFRhc2s8RmlsZT4+IHtcbiAgICByZXR1cm4gKGF3YWl0IGNsaWVudC5wb3N0KFxuICAgICAgJ2ZpbGUvZ2V0JyxcbiAgICAgIHsgLi4ucGFyYW1zIH0sXG4gICAgICB7XG4gICAgICAgIGV4cGVjdDogX0VYUEVDVCxcbiAgICAgICAgcmVzcG9uc2VQYXRoOiAnZmlsZScsXG4gICAgICAgIC4uLmNvbmZpZyxcbiAgICAgIH1cbiAgICApKSBhcyBUYXNrPEZpbGU+O1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBRUE7QUFJQTtBQUEwQztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUcxQyxJQUFNQSxvQkFBb0IsR0FBRyxTQUF2QkEsb0JBQW9CO0VBQUEsSUFBSUMsTUFBTSx1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