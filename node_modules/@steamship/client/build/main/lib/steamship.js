"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Steamship = void 0;
var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));
var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));
var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));
var _api_base = require("./api_base.js");
var _log = _interopRequireDefault(require("./log.js"));
var _package_instance = require("./package_instance.js");
var _plugin_instance = require("./plugin_instance.js");
var _steamship_error = require("./steamship_error.js");
function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2["default"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2["default"])(this, result); }; }
function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
var log = (0, _log["default"])('Steamship');
var Steamship = /*#__PURE__*/function (_ApiBase) {
  (0, _inherits2["default"])(Steamship, _ApiBase);
  var _super = _createSuper(Steamship);
  function Steamship(config) {
    (0, _classCallCheck2["default"])(this, Steamship);
    return _super.call(this, config);
  }

  /**
   * Create a login attempt token, useful for logging in a client from the CLI
   * @returns A response object with a "token" field
   */
  (0, _createClass2["default"])(Steamship, [{
    key: "createLoginAttempt",
    value: function () {
      var _createLoginAttempt = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return this.post('account/create_login_attempt', {});
            case 2:
              return _context.abrupt("return", _context.sent);
            case 3:
            case "end":
              return _context.stop();
          }
        }, _callee, this);
      }));
      function createLoginAttempt() {
        return _createLoginAttempt.apply(this, arguments);
      }
      return createLoginAttempt;
    }()
    /**
     * Creates/loads an instance of package `packageHandle`.
     *
     * The instance is named `instanceHandle` and located in the Workspace named
     * `instanceHandle`.
     *
     * For example, one may write the following to always get back the same package
     * instance, no matter how many times you run it, scoped into its own workspace:
     *
     * ```javascript
     * let package = Steamship.use('package-handle', 'instance-handle')
     * ```
     *
     * If you wish to override the usage of a workspace named `instanceHandle`,
     * you can provide the `workspaceHandle` parameter.
     *
     * @param packageHandle - The package to use
     * @param instanceHandle - The identifier for your instance and its state
     * @param config - A config object parameterizing this package instance
     * @param version - Optional version handle
     * @param reuse - Whether to reuse the existing instance by the provided handle if it exists. Default: true
     * @param workspaceHandle - The workspace to create/use in which this instance should exist. Defaults to `instanceHandle`
     *
     * @returns PackageInstance
     */
  }, {
    key: "use",
    value:
    /**
     * Creates/loads an instance of package `packageHandle`.
     * The instance is named `instanceHandle` and located in the workspace this
     * client is anchored to instanceHandle."""
     * @returns PackageInstance
     */
    function () {
      var _use = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2(packageHandle, instanceHandle, config, version, reuse) {
        var fixedInstanceHandle, response;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) switch (_context2.prev = _context2.next) {
            case 0:
              fixedInstanceHandle = instanceHandle || packageHandle;
              if (typeof reuse == 'undefined') {
                reuse = true;
              }
              _context2.next = 4;
              return _package_instance.PackageInstance.create(this, {
                handle: fixedInstanceHandle,
                packageHandle: packageHandle,
                packageVersionHandle: version,
                fetchIfExists: reuse,
                config: config
              });
            case 4:
              response = _context2.sent;
              if (response.output) {
                _context2.next = 7;
                break;
              }
              throw new _steamship_error.SteamshipError({
                statusMessage: 'Unable to create an instance of your package -- an empty object was returned.'
              });
            case 7:
              return _context2.abrupt("return", response.output);
            case 8:
            case "end":
              return _context2.stop();
          }
        }, _callee2, this);
      }));
      function use(_x, _x2, _x3, _x4, _x5) {
        return _use.apply(this, arguments);
      }
      return use;
    }()
    /**
     * Creates/loads an instance of plugin `pluginHandle`.
     *
     * The instance is named `instanceHandle` and located in the Workspace named `instanceHandle`.
     *
     * For example, one may write the following to always get back the same package instance, no matter how many
     * times you run it, scoped into its own workspace:
     *
     * ```javascript
     * let plugin = Steamship.usePlugin('plugin-handle', 'instance-handle')
     * ```
     *
     * If you wish to override the usage of a workspace named `instanceHandle`,
     * you can provide the `workspaceHandle` parameter.
     * @returns PluginInstance
     */
  }, {
    key: "usePlugin",
    value:
    /**
     * Creates/loads an instance of plugin `pluginHandle`.
     * The instance is named `instanceHandle` and located in the workspace this
     * client is anchored to instanceHandle."""
     * @returns PluginInstance
     */
    function () {
      var _usePlugin = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3(pluginHandle, instanceHandle, config, version, reuse) {
        var fixedInstanceHandle, response;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              fixedInstanceHandle = instanceHandle || pluginHandle;
              if (typeof reuse == 'undefined') {
                reuse = true;
              }
              _context3.next = 4;
              return _plugin_instance.PluginInstance.create(this, {
                handle: fixedInstanceHandle,
                pluginHandle: pluginHandle,
                pluginVersionHandle: version,
                fetchIfExists: reuse,
                config: config
              });
            case 4:
              response = _context3.sent;
              if (response.output) {
                _context3.next = 7;
                break;
              }
              throw new _steamship_error.SteamshipError({
                statusMessage: 'Unable to create an instance of your plugin -- an empty object was returned.'
              });
            case 7:
              return _context3.abrupt("return", response.output);
            case 8:
            case "end":
              return _context3.stop();
          }
        }, _callee3, this);
      }));
      function usePlugin(_x6, _x7, _x8, _x9, _x10) {
        return _usePlugin.apply(this, arguments);
      }
      return usePlugin;
    }()
  }], [{
    key: "use",
    value: function () {
      var _use2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(packageHandle, instanceHandle, config, version, reuse, workspaceHandle) {
        var fixedInstanceHandle, workspace, client;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) switch (_context4.prev = _context4.next) {
            case 0:
              fixedInstanceHandle = instanceHandle || packageHandle;
              workspace = workspaceHandle || fixedInstanceHandle;
              log.info("Steamship.use using workspace ".concat(workspace, ", instanceHandle ").concat(fixedInstanceHandle));
              client = new Steamship({
                workspace: workspace
              });
              return _context4.abrupt("return", client.use(packageHandle, fixedInstanceHandle, config, version, reuse));
            case 5:
            case "end":
              return _context4.stop();
          }
        }, _callee4);
      }));
      function use(_x11, _x12, _x13, _x14, _x15, _x16) {
        return _use2.apply(this, arguments);
      }
      return use;
    }()
  }, {
    key: "usePlugin",
    value: function () {
      var _usePlugin2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5(pluginHandle, instanceHandle, config, version, reuse, workspaceHandle) {
        var fixedInstanceHandle, configArgs, client;
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) switch (_context5.prev = _context5.next) {
            case 0:
              fixedInstanceHandle = instanceHandle || pluginHandle;
              configArgs = {
                workspace: workspaceHandle || fixedInstanceHandle
              };
              client = new Steamship(configArgs);
              return _context5.abrupt("return", client.usePlugin(pluginHandle, fixedInstanceHandle, config, version, reuse));
            case 4:
            case "end":
              return _context5.stop();
          }
        }, _callee5);
      }));
      function usePlugin(_x17, _x18, _x19, _x20, _x21, _x22) {
        return _usePlugin2.apply(this, arguments);
      }
      return usePlugin;
    }()
  }]);
  return Steamship;
}(_api_base.ApiBase);
exports.Steamship = Steamship;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJsb2ciLCJnZXRMb2dnZXIiLCJTdGVhbXNoaXAiLCJjb25maWciLCJwb3N0IiwicGFja2FnZUhhbmRsZSIsImluc3RhbmNlSGFuZGxlIiwidmVyc2lvbiIsInJldXNlIiwiZml4ZWRJbnN0YW5jZUhhbmRsZSIsIlBhY2thZ2VJbnN0YW5jZSIsImNyZWF0ZSIsImhhbmRsZSIsInBhY2thZ2VWZXJzaW9uSGFuZGxlIiwiZmV0Y2hJZkV4aXN0cyIsInJlc3BvbnNlIiwib3V0cHV0IiwiU3RlYW1zaGlwRXJyb3IiLCJzdGF0dXNNZXNzYWdlIiwicGx1Z2luSGFuZGxlIiwiUGx1Z2luSW5zdGFuY2UiLCJwbHVnaW5WZXJzaW9uSGFuZGxlIiwid29ya3NwYWNlSGFuZGxlIiwid29ya3NwYWNlIiwiaW5mbyIsImNsaWVudCIsInVzZSIsImNvbmZpZ0FyZ3MiLCJ1c2VQbHVnaW4iLCJBcGlCYXNlIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9zdGVhbXNoaXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAndHNsb2cnO1xuXG5pbXBvcnQgeyBBcGlCYXNlIH0gZnJvbSAnLi9hcGlfYmFzZS5qcyc7XG5pbXBvcnQgZ2V0TG9nZ2VyIGZyb20gJy4vbG9nLmpzJztcbmltcG9ydCB7IFBhY2thZ2VJbnN0YW5jZSB9IGZyb20gJy4vcGFja2FnZV9pbnN0YW5jZS5qcyc7XG5pbXBvcnQgeyBQbHVnaW5JbnN0YW5jZSB9IGZyb20gJy4vcGx1Z2luX2luc3RhbmNlLmpzJztcbmltcG9ydCB7IExvYWRDb25maWdQYXJhbXMgfSBmcm9tICcuL3NoYXJlZC9Db25maWd1cmF0aW9uLmpzJztcbmltcG9ydCB7IFN0ZWFtc2hpcEVycm9yIH0gZnJvbSAnLi9zdGVhbXNoaXBfZXJyb3IuanMnO1xuaW1wb3J0IHsgVGFzayB9IGZyb20gJy4vdGFzay5qcyc7XG5pbXBvcnQgeyBDcmVhdGVMb2dpbkF0dGVtcHRSZXNwb25zZSB9IGZyb20gJy4vdHlwZXMvYWNjb3VudC5qcyc7XG5cbmNvbnN0IGxvZzogTG9nZ2VyID0gZ2V0TG9nZ2VyKCdTdGVhbXNoaXAnKTtcblxuZXhwb3J0IGNsYXNzIFN0ZWFtc2hpcCBleHRlbmRzIEFwaUJhc2Uge1xuICBwdWJsaWMgY29uc3RydWN0b3IoY29uZmlnPzogTG9hZENvbmZpZ1BhcmFtcykge1xuICAgIHN1cGVyKGNvbmZpZyk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbG9naW4gYXR0ZW1wdCB0b2tlbiwgdXNlZnVsIGZvciBsb2dnaW5nIGluIGEgY2xpZW50IGZyb20gdGhlIENMSVxuICAgKiBAcmV0dXJucyBBIHJlc3BvbnNlIG9iamVjdCB3aXRoIGEgXCJ0b2tlblwiIGZpZWxkXG4gICAqL1xuICBhc3luYyBjcmVhdGVMb2dpbkF0dGVtcHQoKTogUHJvbWlzZTxUYXNrPENyZWF0ZUxvZ2luQXR0ZW1wdFJlc3BvbnNlPj4ge1xuICAgIHJldHVybiAoYXdhaXQgdGhpcy5wb3N0KFxuICAgICAgJ2FjY291bnQvY3JlYXRlX2xvZ2luX2F0dGVtcHQnLFxuICAgICAge31cbiAgICApKSBhcyBUYXNrPENyZWF0ZUxvZ2luQXR0ZW1wdFJlc3BvbnNlPjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzL2xvYWRzIGFuIGluc3RhbmNlIG9mIHBhY2thZ2UgYHBhY2thZ2VIYW5kbGVgLlxuICAgKlxuICAgKiBUaGUgaW5zdGFuY2UgaXMgbmFtZWQgYGluc3RhbmNlSGFuZGxlYCBhbmQgbG9jYXRlZCBpbiB0aGUgV29ya3NwYWNlIG5hbWVkXG4gICAqIGBpbnN0YW5jZUhhbmRsZWAuXG4gICAqXG4gICAqIEZvciBleGFtcGxlLCBvbmUgbWF5IHdyaXRlIHRoZSBmb2xsb3dpbmcgdG8gYWx3YXlzIGdldCBiYWNrIHRoZSBzYW1lIHBhY2thZ2VcbiAgICogaW5zdGFuY2UsIG5vIG1hdHRlciBob3cgbWFueSB0aW1lcyB5b3UgcnVuIGl0LCBzY29wZWQgaW50byBpdHMgb3duIHdvcmtzcGFjZTpcbiAgICpcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiBsZXQgcGFja2FnZSA9IFN0ZWFtc2hpcC51c2UoJ3BhY2thZ2UtaGFuZGxlJywgJ2luc3RhbmNlLWhhbmRsZScpXG4gICAqIGBgYFxuICAgKlxuICAgKiBJZiB5b3Ugd2lzaCB0byBvdmVycmlkZSB0aGUgdXNhZ2Ugb2YgYSB3b3Jrc3BhY2UgbmFtZWQgYGluc3RhbmNlSGFuZGxlYCxcbiAgICogeW91IGNhbiBwcm92aWRlIHRoZSBgd29ya3NwYWNlSGFuZGxlYCBwYXJhbWV0ZXIuXG4gICAqXG4gICAqIEBwYXJhbSBwYWNrYWdlSGFuZGxlIC0gVGhlIHBhY2thZ2UgdG8gdXNlXG4gICAqIEBwYXJhbSBpbnN0YW5jZUhhbmRsZSAtIFRoZSBpZGVudGlmaWVyIGZvciB5b3VyIGluc3RhbmNlIGFuZCBpdHMgc3RhdGVcbiAgICogQHBhcmFtIGNvbmZpZyAtIEEgY29uZmlnIG9iamVjdCBwYXJhbWV0ZXJpemluZyB0aGlzIHBhY2thZ2UgaW5zdGFuY2VcbiAgICogQHBhcmFtIHZlcnNpb24gLSBPcHRpb25hbCB2ZXJzaW9uIGhhbmRsZVxuICAgKiBAcGFyYW0gcmV1c2UgLSBXaGV0aGVyIHRvIHJldXNlIHRoZSBleGlzdGluZyBpbnN0YW5jZSBieSB0aGUgcHJvdmlkZWQgaGFuZGxlIGlmIGl0IGV4aXN0cy4gRGVmYXVsdDogdHJ1ZVxuICAgKiBAcGFyYW0gd29ya3NwYWNlSGFuZGxlIC0gVGhlIHdvcmtzcGFjZSB0byBjcmVhdGUvdXNlIGluIHdoaWNoIHRoaXMgaW5zdGFuY2Ugc2hvdWxkIGV4aXN0LiBEZWZhdWx0cyB0byBgaW5zdGFuY2VIYW5kbGVgXG4gICAqXG4gICAqIEByZXR1cm5zIFBhY2thZ2VJbnN0YW5jZVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBhc3luYyB1c2UoXG4gICAgcGFja2FnZUhhbmRsZTogc3RyaW5nLFxuICAgIGluc3RhbmNlSGFuZGxlPzogc3RyaW5nLFxuICAgIGNvbmZpZz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgIHZlcnNpb24/OiBzdHJpbmcsXG4gICAgcmV1c2U/OiBib29sZWFuLFxuICAgIHdvcmtzcGFjZUhhbmRsZT86IHN0cmluZ1xuICApOiBQcm9taXNlPFBhY2thZ2VJbnN0YW5jZT4ge1xuICAgIGNvbnN0IGZpeGVkSW5zdGFuY2VIYW5kbGUgPSBpbnN0YW5jZUhhbmRsZSB8fCBwYWNrYWdlSGFuZGxlO1xuICAgIGNvbnN0IHdvcmtzcGFjZSA9IHdvcmtzcGFjZUhhbmRsZSB8fCBmaXhlZEluc3RhbmNlSGFuZGxlO1xuICAgIGxvZy5pbmZvKFxuICAgICAgYFN0ZWFtc2hpcC51c2UgdXNpbmcgd29ya3NwYWNlICR7d29ya3NwYWNlfSwgaW5zdGFuY2VIYW5kbGUgJHtmaXhlZEluc3RhbmNlSGFuZGxlfWBcbiAgICApO1xuICAgIGNvbnN0IGNsaWVudCA9IG5ldyBTdGVhbXNoaXAoeyB3b3Jrc3BhY2UgfSk7XG4gICAgcmV0dXJuIGNsaWVudC51c2UoXG4gICAgICBwYWNrYWdlSGFuZGxlLFxuICAgICAgZml4ZWRJbnN0YW5jZUhhbmRsZSxcbiAgICAgIGNvbmZpZyxcbiAgICAgIHZlcnNpb24sXG4gICAgICByZXVzZVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcy9sb2FkcyBhbiBpbnN0YW5jZSBvZiBwYWNrYWdlIGBwYWNrYWdlSGFuZGxlYC5cbiAgICogVGhlIGluc3RhbmNlIGlzIG5hbWVkIGBpbnN0YW5jZUhhbmRsZWAgYW5kIGxvY2F0ZWQgaW4gdGhlIHdvcmtzcGFjZSB0aGlzXG4gICAqIGNsaWVudCBpcyBhbmNob3JlZCB0byBpbnN0YW5jZUhhbmRsZS5cIlwiXCJcbiAgICogQHJldHVybnMgUGFja2FnZUluc3RhbmNlXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgdXNlKFxuICAgIHBhY2thZ2VIYW5kbGU6IHN0cmluZyxcbiAgICBpbnN0YW5jZUhhbmRsZT86IHN0cmluZyxcbiAgICBjb25maWc/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbiAgICB2ZXJzaW9uPzogc3RyaW5nLFxuICAgIHJldXNlPzogYm9vbGVhblxuICApOiBQcm9taXNlPFBhY2thZ2VJbnN0YW5jZT4ge1xuICAgIGNvbnN0IGZpeGVkSW5zdGFuY2VIYW5kbGUgPSBpbnN0YW5jZUhhbmRsZSB8fCBwYWNrYWdlSGFuZGxlO1xuICAgIGlmICh0eXBlb2YgcmV1c2UgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldXNlID0gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBQYWNrYWdlSW5zdGFuY2UuY3JlYXRlKHRoaXMsIHtcbiAgICAgIGhhbmRsZTogZml4ZWRJbnN0YW5jZUhhbmRsZSxcbiAgICAgIHBhY2thZ2VIYW5kbGU6IHBhY2thZ2VIYW5kbGUsXG4gICAgICBwYWNrYWdlVmVyc2lvbkhhbmRsZTogdmVyc2lvbixcbiAgICAgIGZldGNoSWZFeGlzdHM6IHJldXNlLFxuICAgICAgY29uZmlnOiBjb25maWcsXG4gICAgfSk7XG4gICAgaWYgKCFyZXNwb25zZS5vdXRwdXQpIHtcbiAgICAgIHRocm93IG5ldyBTdGVhbXNoaXBFcnJvcih7XG4gICAgICAgIHN0YXR1c01lc3NhZ2U6XG4gICAgICAgICAgJ1VuYWJsZSB0byBjcmVhdGUgYW4gaW5zdGFuY2Ugb2YgeW91ciBwYWNrYWdlIC0tIGFuIGVtcHR5IG9iamVjdCB3YXMgcmV0dXJuZWQuJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2Uub3V0cHV0O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMvbG9hZHMgYW4gaW5zdGFuY2Ugb2YgcGx1Z2luIGBwbHVnaW5IYW5kbGVgLlxuICAgKlxuICAgKiBUaGUgaW5zdGFuY2UgaXMgbmFtZWQgYGluc3RhbmNlSGFuZGxlYCBhbmQgbG9jYXRlZCBpbiB0aGUgV29ya3NwYWNlIG5hbWVkIGBpbnN0YW5jZUhhbmRsZWAuXG4gICAqXG4gICAqIEZvciBleGFtcGxlLCBvbmUgbWF5IHdyaXRlIHRoZSBmb2xsb3dpbmcgdG8gYWx3YXlzIGdldCBiYWNrIHRoZSBzYW1lIHBhY2thZ2UgaW5zdGFuY2UsIG5vIG1hdHRlciBob3cgbWFueVxuICAgKiB0aW1lcyB5b3UgcnVuIGl0LCBzY29wZWQgaW50byBpdHMgb3duIHdvcmtzcGFjZTpcbiAgICpcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiBsZXQgcGx1Z2luID0gU3RlYW1zaGlwLnVzZVBsdWdpbigncGx1Z2luLWhhbmRsZScsICdpbnN0YW5jZS1oYW5kbGUnKVxuICAgKiBgYGBcbiAgICpcbiAgICogSWYgeW91IHdpc2ggdG8gb3ZlcnJpZGUgdGhlIHVzYWdlIG9mIGEgd29ya3NwYWNlIG5hbWVkIGBpbnN0YW5jZUhhbmRsZWAsXG4gICAqIHlvdSBjYW4gcHJvdmlkZSB0aGUgYHdvcmtzcGFjZUhhbmRsZWAgcGFyYW1ldGVyLlxuICAgKiBAcmV0dXJucyBQbHVnaW5JbnN0YW5jZVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBhc3luYyB1c2VQbHVnaW4oXG4gICAgcGx1Z2luSGFuZGxlOiBzdHJpbmcsXG4gICAgaW5zdGFuY2VIYW5kbGU/OiBzdHJpbmcsXG4gICAgY29uZmlnPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4gICAgdmVyc2lvbj86IHN0cmluZyxcbiAgICByZXVzZT86IGJvb2xlYW4sXG4gICAgd29ya3NwYWNlSGFuZGxlPzogc3RyaW5nXG4gICk6IFByb21pc2U8UGx1Z2luSW5zdGFuY2U+IHtcbiAgICBjb25zdCBmaXhlZEluc3RhbmNlSGFuZGxlID0gaW5zdGFuY2VIYW5kbGUgfHwgcGx1Z2luSGFuZGxlO1xuICAgIGNvbnN0IGNvbmZpZ0FyZ3M6IExvYWRDb25maWdQYXJhbXMgPSB7XG4gICAgICB3b3Jrc3BhY2U6IHdvcmtzcGFjZUhhbmRsZSB8fCBmaXhlZEluc3RhbmNlSGFuZGxlLFxuICAgIH07XG4gICAgY29uc3QgY2xpZW50ID0gbmV3IFN0ZWFtc2hpcChjb25maWdBcmdzKTtcbiAgICByZXR1cm4gY2xpZW50LnVzZVBsdWdpbihcbiAgICAgIHBsdWdpbkhhbmRsZSxcbiAgICAgIGZpeGVkSW5zdGFuY2VIYW5kbGUsXG4gICAgICBjb25maWcsXG4gICAgICB2ZXJzaW9uLFxuICAgICAgcmV1c2VcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMvbG9hZHMgYW4gaW5zdGFuY2Ugb2YgcGx1Z2luIGBwbHVnaW5IYW5kbGVgLlxuICAgKiBUaGUgaW5zdGFuY2UgaXMgbmFtZWQgYGluc3RhbmNlSGFuZGxlYCBhbmQgbG9jYXRlZCBpbiB0aGUgd29ya3NwYWNlIHRoaXNcbiAgICogY2xpZW50IGlzIGFuY2hvcmVkIHRvIGluc3RhbmNlSGFuZGxlLlwiXCJcIlxuICAgKiBAcmV0dXJucyBQbHVnaW5JbnN0YW5jZVxuICAgKi9cbiAgcHVibGljIGFzeW5jIHVzZVBsdWdpbihcbiAgICBwbHVnaW5IYW5kbGU6IHN0cmluZyxcbiAgICBpbnN0YW5jZUhhbmRsZT86IHN0cmluZyxcbiAgICBjb25maWc/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbiAgICB2ZXJzaW9uPzogc3RyaW5nLFxuICAgIHJldXNlPzogYm9vbGVhblxuICApOiBQcm9taXNlPFBsdWdpbkluc3RhbmNlPiB7XG4gICAgY29uc3QgZml4ZWRJbnN0YW5jZUhhbmRsZSA9IGluc3RhbmNlSGFuZGxlIHx8IHBsdWdpbkhhbmRsZTtcbiAgICBpZiAodHlwZW9mIHJldXNlID09ICd1bmRlZmluZWQnKSB7XG4gICAgICByZXVzZSA9IHRydWU7XG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUGx1Z2luSW5zdGFuY2UuY3JlYXRlKHRoaXMsIHtcbiAgICAgIGhhbmRsZTogZml4ZWRJbnN0YW5jZUhhbmRsZSxcbiAgICAgIHBsdWdpbkhhbmRsZTogcGx1Z2luSGFuZGxlLFxuICAgICAgcGx1Z2luVmVyc2lvbkhhbmRsZTogdmVyc2lvbixcbiAgICAgIGZldGNoSWZFeGlzdHM6IHJldXNlLFxuICAgICAgY29uZmlnOiBjb25maWcsXG4gICAgfSk7XG4gICAgaWYgKCFyZXNwb25zZS5vdXRwdXQpIHtcbiAgICAgIHRocm93IG5ldyBTdGVhbXNoaXBFcnJvcih7XG4gICAgICAgIHN0YXR1c01lc3NhZ2U6XG4gICAgICAgICAgJ1VuYWJsZSB0byBjcmVhdGUgYW4gaW5zdGFuY2Ugb2YgeW91ciBwbHVnaW4gLS0gYW4gZW1wdHkgb2JqZWN0IHdhcyByZXR1cm5lZC4nLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXNwb25zZS5vdXRwdXQ7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQXNEO0FBQUE7QUFJdEQsSUFBTUEsR0FBVyxHQUFHLElBQUFDLGVBQVMsRUFBQyxXQUFXLENBQUM7QUFBQyxJQUU5QkMsU0FBUztFQUFBO0VBQUE7RUFDcEIsbUJBQW1CQyxNQUF5QixFQUFFO0lBQUE7SUFBQSx5QkFDdENBLE1BQU07RUFDZDs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtFQUhFO0lBQUE7SUFBQTtNQUFBLHdHQUlBO1FBQUE7VUFBQTtZQUFBO2NBQUE7Y0FBQSxPQUNnQixJQUFJLENBQUNDLElBQUksQ0FDckIsOEJBQThCLEVBQzlCLENBQUMsQ0FBQyxDQUNIO1lBQUE7Y0FBQTtZQUFBO1lBQUE7Y0FBQTtVQUFBO1FBQUE7TUFBQSxDQUNGO01BQUE7UUFBQTtNQUFBO01BQUE7SUFBQTtJQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBeEJFO0lBQUE7SUFBQTtJQWdEQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7SUFMRTtNQUFBLHlGQU1BLGtCQUNFQyxhQUFxQixFQUNyQkMsY0FBdUIsRUFDdkJILE1BQWdDLEVBQ2hDSSxPQUFnQixFQUNoQkMsS0FBZTtRQUFBO1FBQUE7VUFBQTtZQUFBO2NBRVRDLG1CQUFtQixHQUFHSCxjQUFjLElB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