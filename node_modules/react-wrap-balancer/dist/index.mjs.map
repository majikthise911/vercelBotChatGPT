{"version":3,"sources":["../src/index.tsx"],"sourcesContent":["'use client'\n\nimport React from 'react'\n\nconst SYMBOL_KEY = '__wrap_balancer'\nconst IS_SERVER = typeof window === 'undefined'\nconst useIsomorphicLayoutEffect = IS_SERVER\n  ? React.useEffect\n  : React.useLayoutEffect\n\n// Register the balancer globally on client.\n/* Compressed with SWC using the following config:\n{\n  \"jsc\": {\n    \"parser\": {\n      \"syntax\": \"ecmascript\",\n      \"jsx\": true\n    },\n    \"target\": \"es2015\",\n    \"loose\": true,\n    \"minify\": {\n      \"compress\": {\n        \"arguments\": true,\n        \"arrows\": true,\n        \"booleans\": true,\n        \"booleans_as_integers\": true,\n        \"collapse_vars\": true,\n        \"comparisons\": true,\n        \"computed_props\": true,\n        \"conditionals\": true,\n        \"dead_code\": true,\n        \"directives\": true,\n        \"drop_console\": true,\n        \"drop_debugger\": true,\n        \"evaluate\": true,\n        \"expression\": true,\n        \"hoist_funs\": true,\n        \"hoist_props\": true,\n        \"hoist_vars\": true,\n        \"if_return\": true,\n        \"join_vars\": true,\n        \"keep_classnames\": true,\n        \"keep_fargs\": true,\n        \"keep_fnames\": true,\n        \"keep_infinity\": true,\n        \"loops\": true,\n        \"negate_iife\": true,\n        \"properties\": true,\n        \"reduce_funcs\": true,\n        \"reduce_vars\": true,\n        \"side_effects\": true,\n        \"switches\": true,\n        \"typeofs\": true,\n        \"unsafe\": true,\n        \"unsafe_arrows\": true,\n        \"unsafe_comps\": true,\n        \"unsafe_Function\": true,\n        \"unsafe_math\": true,\n        \"unsafe_symbols\": true,\n        \"unsafe_methods\": true,\n        \"unsafe_proto\": true,\n        \"unsafe_regexp\": true,\n        \"unsafe_undefined\": true,\n        \"unused\": true,\n        \"const_to_let\": true,\n        \"pristine_globals\": true\n      },\n      \"mangle\": {\n        \"toplevel\": true,\n        \"keep_classnames\": false,\n        \"keep_fnames\": false,\n        \"keep_private_props\": false,\n        \"ie8\": false,\n        \"safari10\": false\n      }\n    }\n  },\n  \"module\": {\n    \"type\": \"es6\"\n  },\n  \"minify\": true,\n  \"isModule\": true\n}\n */\n// const layout = (id: string, wrapper?: HTMLElement) => {\n//   wrapper =\n//     wrapper ||\n//     (document.querySelector(`[data-balancer=\"${id}\"]`) as HTMLElement)\n//   const container = wrapper.parentElement as HTMLElement\n\n//   const update = (width) => (wrapper.style.maxWidth = width + 'px')\n\n//   // Reset wrapper width\n//   wrapper.style.maxWidth = ''\n\n//   // Get the intial container size\n//   const w = container.clientWidth\n//   const h = container.clientHeight\n//   if (!w) return\n\n//   // Synchrnously do binary search and calculate the layout\n//   let l = w / 2\n//   let r = w\n//   let m\n//   while (l + 1 < r) {\n//     m = ~~((l + r) / 2)\n//     update(m)\n//     if (container.clientHeight == h) {\n//       r = m\n//     } else {\n//       l = m\n//     }\n//   }\n\n//   // Update the wrapper width\n//   update(r)\n// }\n\ntype Props = {\n  as?: string\n  children?: React.ReactNode\n}\n\n// As Next.js adds `display: none` to `body` for development, we need to trigger\n// a re-balance right after the style is removed, synchronously.\nif (!IS_SERVER && process.env.NODE_ENV !== 'production') {\n  const next_dev_style = document.querySelector('[data-next-hide-fouc]')\n  if (next_dev_style) {\n    const callback = (mutationList) => {\n      for (const mutation of mutationList) {\n        if (mutation.removedNodes.length) {\n          for (const node of mutation.removedNodes) {\n            if (node === next_dev_style) {\n              observer.disconnect()\n              const el = document.querySelectorAll('[data-balancer]')\n              // @ts-ignore\n              for (const e of el) {\n                self[SYMBOL_KEY](0, e)\n              }\n            }\n          }\n        }\n      }\n    }\n    const observer = new MutationObserver(callback)\n    observer.observe(document.head, { childList: true })\n  }\n}\n\nconst Balancer: React.FC<Props> = ({ as = 'span', children, ...props }) => {\n  const As = as\n  const id = React.useId()\n  const wrapperRef = React.useRef()\n\n  // Re-balance on content change and on mount/hydration\n  useIsomorphicLayoutEffect(() => {\n    if (!wrapperRef.current) return\n    self[SYMBOL_KEY](0, wrapperRef.current)\n  }, [children])\n\n  // Re-balance on resize\n  useIsomorphicLayoutEffect(() => {\n    if (!wrapperRef.current) return\n\n    const container = wrapperRef.current.parentElement as HTMLElement\n    if (!container) return\n\n    const resizeObserver = new ResizeObserver(() => {\n      if (!wrapperRef.current) return\n      self[SYMBOL_KEY](0, wrapperRef.current)\n    })\n    resizeObserver.observe(container)\n    return () => resizeObserver.unobserve(container)\n  }, [])\n\n  return (\n    <>\n      <As\n        {...props}\n        data-balancer={id}\n        ref={wrapperRef}\n        style={{\n          display: 'inline-block',\n          verticalAlign: 'top',\n          textDecoration: 'inherit',\n        }}\n        suppressHydrationWarning={true}\n      >\n        {children}\n      </As>\n      <script\n        dangerouslySetInnerHTML={{\n          // Calculate the balance initially for SSR\n          __html: `self.${SYMBOL_KEY}=${'((e,t)=>{let l;t=t||document.querySelector(`[data-balancer=\"${e}\"]`);let a=t.parentElement,f=e=>t.style.maxWidth=e+\"px\";t.style.maxWidth=\"\";let o=a.clientWidth,d=a.clientHeight,i=o/2,r=o;if(!o)return;for(;i+1<r;)f(l=~~((i+r)/2)),a.clientHeight==d?r=l:i=l;f(r)})'};self.${SYMBOL_KEY}(\"${id}\")`,\n        }}\n      ></script>\n    </>\n  )\n}\n\nexport default Balancer\n"],"mappings":";AAEA,OAAOA,MAAW,QAElB,IAAMC,EAAa,kBACbC,EAAY,OAAO,QAAW,YAC9BC,EAA4BD,EAC9BF,EAAM,UACNA,EAAM,gBAqHV,GAAI,CAACE,GAAa,QAAQ,IAAI,WAAa,aAAc,CACvD,IAAME,EAAiB,SAAS,cAAc,uBAAuB,EACrE,GAAIA,EAAgB,CAClB,IAAMC,EAAYC,GAAiB,CACjC,QAAWC,KAAYD,EACrB,GAAIC,EAAS,aAAa,QACxB,QAAWC,KAAQD,EAAS,aAC1B,GAAIC,IAASJ,EAAgB,CAC3BK,EAAS,WAAW,EACpB,IAAMC,EAAK,SAAS,iBAAiB,iBAAiB,EAEtD,QAAWC,KAAKD,EACd,KAAKT,GAAY,EAAGU,CAAC,CAEzB,EAIR,EACMF,EAAW,IAAI,iBAAiBJ,CAAQ,EAC9CI,EAAS,QAAQ,SAAS,KAAM,CAAE,UAAW,EAAK,CAAC,CACrD,CACF,CAEA,IAAMG,EAA4B,CAAC,CAAE,GAAAC,EAAK,OAAQ,SAAAC,KAAaC,CAAM,IAAM,CACzE,IAAMC,EAAKH,EACLI,EAAKjB,EAAM,MAAM,EACjBkB,EAAalB,EAAM,OAAO,EAGhC,OAAAG,EAA0B,IAAM,CAC1B,CAACe,EAAW,SAChB,KAAKjB,GAAY,EAAGiB,EAAW,OAAO,CACxC,EAAG,CAACJ,CAAQ,CAAC,EAGbX,EAA0B,IAAM,CAC9B,GAAI,CAACe,EAAW,QAAS,OAEzB,IAAMC,EAAYD,EAAW,QAAQ,cACrC,GAAI,CAACC,EAAW,OAEhB,IAAMC,EAAiB,IAAI,eAAe,IAAM,CAC1C,CAACF,EAAW,SAChB,KAAKjB,GAAY,EAAGiB,EAAW,OAAO,CACxC,CAAC,EACD,OAAAE,EAAe,QAAQD,CAAS,EACzB,IAAMC,EAAe,UAAUD,CAAS,CACjD,EAAG,CAAC,CAAC,EAGHnB,EAAA,cAAAA,EAAA,cACEA,EAAA,cAACgB,EAAA,CACE,GAAGD,EACJ,gBAAeE,EACf,IAAKC,EACL,MAAO,CACL,QAAS,eACT,cAAe,MACf,eAAgB,SAClB,EACA,yBAA0B,IAEzBJ,CACH,EACAd,EAAA,cAAC,UACC,wBAAyB,CAEvB,OAAQ,QAAQC,mRAA8RA,MAAegB,KAC/T,EACD,CACH,CAEJ,EAEOI,EAAQT","names":["React","SYMBOL_KEY","IS_SERVER","useIsomorphicLayoutEffect","next_dev_style","callback","mutationList","mutation","node","observer","el","e","Balancer","as","children","props","As","id","wrapperRef","container","resizeObserver","src_default"]}